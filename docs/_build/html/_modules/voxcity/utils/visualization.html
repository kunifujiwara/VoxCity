<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <link rel="shortcut icon" href="../../../_static/favicon.ico"/><!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>voxcity.utils.visualization - VoxCity Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=7edd21af" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">VoxCity Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/logo.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/logo.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">VoxCity Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html"><strong>VoxCity Demo</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html#step1-prepare-environment">Step1. Prepare environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html#step2-set-target-area-by-a-rectangle">Step2. Set target area by a rectangle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html#step3-set-variables">Step3 Set variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html#step4-get-voxcity-output">Step4 Get voxcity output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html#step5-export-files">Step5 Export files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html#step6-urban-simulations">Step6 Urban simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html#solar-radiation">6.1. Solar radiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html#landmark-visibility">6.3. Landmark visibility</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../autoapi/voxcity/index.html">voxcity</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of voxcity</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/voxcity/downloader/index.html">voxcity.downloader</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of voxcity.downloader</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/downloader/citygml/index.html">voxcity.downloader.citygml</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/downloader/eubucco/index.html">voxcity.downloader.eubucco</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/downloader/gee/index.html">voxcity.downloader.gee</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/downloader/mbfp/index.html">voxcity.downloader.mbfp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/downloader/oemj/index.html">voxcity.downloader.oemj</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/downloader/osm/index.html">voxcity.downloader.osm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/downloader/overture/index.html">voxcity.downloader.overture</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/voxcity/exporter/index.html">voxcity.exporter</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of voxcity.exporter</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/exporter/envimet/index.html">voxcity.exporter.envimet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/exporter/magicavoxel/index.html">voxcity.exporter.magicavoxel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/exporter/obj/index.html">voxcity.exporter.obj</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/voxcity/generator/index.html">voxcity.generator</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/voxcity/geoprocessor/index.html">voxcity.geoprocessor</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of voxcity.geoprocessor</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/geoprocessor/draw/index.html">voxcity.geoprocessor.draw</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/geoprocessor/grid/index.html">voxcity.geoprocessor.grid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/geoprocessor/mesh/index.html">voxcity.geoprocessor.mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/geoprocessor/network/index.html">voxcity.geoprocessor.network</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/geoprocessor/polygon/index.html">voxcity.geoprocessor.polygon</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/voxcity/simulator/index.html">voxcity.simulator</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of voxcity.simulator</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/simulator/solar/index.html">voxcity.simulator.solar</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/voxcity/simulator/view/index.html">voxcity.simulator.view</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial:</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../examples/index.html">Use cases of VoxCity</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Use cases of VoxCity</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/demo_basic.html"><strong>VoxCity Demo</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/demo_basic.html#step1-prepare-environment">Step1. Prepare environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/demo_basic.html#step2-set-target-area-by-a-rectangle">Step2. Set target area by a rectangle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/demo_basic.html#step3-set-variables">Step3 Set variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/demo_basic.html#step4-get-voxcity-output">Step4 Get voxcity output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/demo_basic.html#step5-export-files">Step5 Export files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/demo_basic.html#step6-urban-simulations">Step6 Urban simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/demo_basic.html#solar-radiation">6.1. Solar radiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/demo_basic.html#landmark-visibility">6.3. Landmark visibility</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Information:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">=======
History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">============
Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../conduct.html">====================================
Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">References</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for voxcity.utils.visualization</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">VoxelCity Visualization Utilities</span>

<span class="sd">This module provides comprehensive visualization tools for 3D voxel city data,</span>
<span class="sd">including support for multiple color schemes, 3D plotting with matplotlib and plotly,</span>
<span class="sd">grid visualization on basemaps, and mesh-based rendering with PyVista.</span>

<span class="sd">The module handles various data types including:</span>
<span class="sd">- Land cover classifications</span>
<span class="sd">- Building heights and footprints</span>
<span class="sd">- Digital elevation models (DEM)</span>
<span class="sd">- Canopy heights</span>
<span class="sd">- View indices (sky view factor, green view index)</span>
<span class="sd">- Simulation results on building surfaces</span>

<span class="sd">Key Features:</span>
<span class="sd">- Multiple predefined color schemes for voxel visualization</span>
<span class="sd">- 2D and 3D plotting capabilities</span>
<span class="sd">- Interactive web maps with folium</span>
<span class="sd">- Mesh export functionality (OBJ format)</span>
<span class="sd">- Multi-view scene generation</span>
<span class="sd">- Custom simulation result overlays</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.mplot3d</span><span class="w"> </span><span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mcolors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListedColormap</span><span class="p">,</span> <span class="n">BoundaryNorm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.cm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">contextily</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ctx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyproj</span>
<span class="c1"># import rasterio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyproj</span><span class="w"> </span><span class="kn">import</span> <span class="n">CRS</span>
<span class="c1"># from shapely.geometry import box</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">folium</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">trimesh</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvista</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># Import utility functions for land cover classification</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.lc</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_land_cover_classes</span>
<span class="c1"># from ..geo.geojson import filter_buildings</span>

<span class="c1"># Import grid processing functions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..geoprocessor.grid</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">calculate_grid_size</span><span class="p">,</span>
    <span class="n">create_coordinate_mesh</span><span class="p">,</span>
    <span class="n">create_cell_polygon</span><span class="p">,</span>
    <span class="n">grid_to_geodataframe</span>
<span class="p">)</span>

<span class="c1"># Import geospatial utility functions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..geoprocessor.utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">initialize_geod</span><span class="p">,</span>
    <span class="n">calculate_distance</span><span class="p">,</span>
    <span class="n">normalize_to_one_meter</span><span class="p">,</span>
    <span class="n">setup_transformer</span><span class="p">,</span>
    <span class="n">transform_coords</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Import mesh generation and export functions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..geoprocessor.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">create_voxel_mesh</span><span class="p">,</span>
    <span class="n">create_sim_surface_mesh</span><span class="p">,</span>
    <span class="n">create_city_meshes</span><span class="p">,</span>
    <span class="n">export_meshes</span><span class="p">,</span>
    <span class="n">save_obj_from_colored_mesh</span>
<span class="p">)</span>
<span class="c1"># from ..exporter.obj import save_obj_from_colored_mesh</span>

<span class="c1"># Import material property functions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.material</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_material_dict</span>

<div class="viewcode-block" id="get_voxel_color_map">
<a class="viewcode-back" href="../../../autoapi/voxcity/exporter/index.html#voxcity.exporter.get_voxel_color_map">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_voxel_color_map</span><span class="p">(</span><span class="n">color_scheme</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a color map for voxel visualization based on the specified color scheme.</span>
<span class="sd">    </span>
<span class="sd">    This function provides multiple predefined color schemes for visualizing voxel data.</span>
<span class="sd">    Each scheme maps voxel class IDs to RGB color values [0-255]. The class IDs follow</span>
<span class="sd">    a specific convention where negative values represent built environment elements</span>
<span class="sd">    and positive values represent natural/ground surface elements.</span>
<span class="sd">    </span>
<span class="sd">    Voxel Class ID Convention:</span>
<span class="sd">        -99: Void/empty space (black)</span>
<span class="sd">        -30: Landmark buildings (special highlighting)</span>
<span class="sd">        -17 to -11: Building materials (plaster, glass, stone, metal, concrete, wood, brick)</span>
<span class="sd">        -3: Generic building structures</span>
<span class="sd">        -2: Trees/vegetation (above ground)</span>
<span class="sd">        -1: Underground/subsurface</span>
<span class="sd">        1-14: Ground surface land cover types (bareland, vegetation, water, etc.)</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    color_scheme : str, optional</span>
<span class="sd">        The name of the color scheme to use. Available options:</span>
<span class="sd">        </span>
<span class="sd">        Basic Schemes:</span>
<span class="sd">        - &#39;default&#39;: Original balanced color scheme for general use</span>
<span class="sd">        - &#39;high_contrast&#39;: High contrast colors for better visibility</span>
<span class="sd">        - &#39;monochrome&#39;: Shades of blue for academic presentations</span>
<span class="sd">        - &#39;pastel&#39;: Softer, muted colors for aesthetic appeal</span>
<span class="sd">        - &#39;dark_mode&#39;: Darker colors for dark backgrounds</span>
<span class="sd">        - &#39;grayscale&#39;: Black and white gradient with color accents</span>
<span class="sd">        </span>
<span class="sd">        Thematic Schemes:</span>
<span class="sd">        - &#39;autumn&#39;: Warm reds, oranges, and browns</span>
<span class="sd">        - &#39;cool&#39;: Cool blues, purples, and cyans</span>
<span class="sd">        - &#39;earth_tones&#39;: Natural earth colors</span>
<span class="sd">        - &#39;vibrant&#39;: Very bright, saturated colors</span>
<span class="sd">        </span>
<span class="sd">        Stylistic Schemes:</span>
<span class="sd">        - &#39;cyberpunk&#39;: Neon-like purples, pinks, and blues</span>
<span class="sd">        - &#39;tropical&#39;: Vibrant greens, oranges, pinks (island vibes)</span>
<span class="sd">        - &#39;vintage&#39;: Muted, sepia-like tones</span>
<span class="sd">        - &#39;neon_dreams&#39;: Super-bright, nightclub neon palette</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary mapping voxel class IDs (int) to RGB color values (list of 3 ints [0-255])</span>
<span class="sd">        </span>
<span class="sd">    Examples:</span>
<span class="sd">    ---------</span>
<span class="sd">    &gt;&gt;&gt; colors = get_voxel_color_map(&#39;default&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(colors[-3])  # Building color</span>
<span class="sd">    [180, 187, 216]</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; colors = get_voxel_color_map(&#39;cyberpunk&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(colors[9])   # Water color in cyberpunk scheme</span>
<span class="sd">    [51, 0, 102]</span>
<span class="sd">    </span>
<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - All color values are in RGB format with range [0, 255]</span>
<span class="sd">    - The &#39;default&#39; scheme should not be modified to maintain consistency</span>
<span class="sd">    - Unknown color schemes will fall back to &#39;default&#39; with a warning</span>
<span class="sd">    - Color schemes can be extended by adding new elif blocks</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ----------------------</span>
    <span class="c1"># DO NOT MODIFY DEFAULT</span>
    <span class="c1"># ----------------------</span>
    <span class="k">if</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># void,</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">],</span>  <span class="c1"># (Pink) &#39;Landmark&#39;,</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">238</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">234</span><span class="p">],</span>  <span class="c1"># (light gray) &#39;plaster&#39;,</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">56</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">84</span><span class="p">],</span>  <span class="c1"># (Dark blue) &#39;glass&#39;,</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">147</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">114</span><span class="p">],</span>  <span class="c1"># (Light brown) &#39;stone&#39;,</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">139</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">159</span><span class="p">],</span>  <span class="c1"># (Gray) &#39;metal&#39;,</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">186</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">181</span><span class="p">],</span>  <span class="c1"># (Gray) &#39;concrete&#39;,</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">248</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>  <span class="c1"># (Orange) &#39;wood&#39;,</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">81</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">56</span><span class="p">],</span>  <span class="c1"># (Dark red) &#39;brick&#39;,</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">180</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">216</span><span class="p">],</span>  <span class="c1"># Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">63</span><span class="p">],</span>     <span class="c1"># Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">188</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">143</span><span class="p">],</span>  <span class="c1"># Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">239</span><span class="p">,</span> <span class="mi">228</span><span class="p">,</span> <span class="mi">176</span><span class="p">],</span>   <span class="c1"># &#39;Bareland (ground surface)&#39;,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">123</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">59</span><span class="p">],</span>   <span class="c1"># &#39;Rangeland (ground surface)&#39;,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">97</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">86</span><span class="p">],</span>   <span class="c1"># &#39;Shrub (ground surface)&#39;,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">112</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">56</span><span class="p">],</span>   <span class="c1">#  &#39;Agriculture land (ground surface)&#39;,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">116</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">66</span><span class="p">],</span>   <span class="c1">#  &#39;Tree (ground surface)&#39;,</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">187</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>   <span class="c1">#  &#39;Moss and lichen (ground surface)&#39;,</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">77</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">99</span><span class="p">],</span>    <span class="c1">#  &#39;Wet land (ground surface)&#39;,</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">51</span><span class="p">],</span>    <span class="c1">#  &#39;Mangrove (ground surface)&#39;,</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">44</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">133</span><span class="p">],</span>    <span class="c1">#  &#39;Water (ground surface)&#39;,</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">205</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">224</span><span class="p">],</span>    <span class="c1">#  &#39;Snow and ice (ground surface)&#39;,</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">108</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">129</span><span class="p">],</span>   <span class="c1">#  &#39;Developed space (ground surface)&#39;,</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">59</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">87</span><span class="p">],</span>      <span class="c1"># &#39;Road (ground surface)&#39;,</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">190</span><span class="p">],</span>    <span class="c1">#  &#39;Building (ground surface)&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">239</span><span class="p">,</span> <span class="mi">228</span><span class="p">,</span> <span class="mi">176</span><span class="p">],</span>    <span class="c1">#  &#39;No Data (ground surface)&#39;</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;high_contrast&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># void</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>  <span class="c1"># (Bright Magenta) &#39;Landmark&#39;</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>  <span class="c1"># (Pure White) &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>  <span class="c1"># (Bright Blue) &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">153</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># (Dark Brown) &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">],</span>  <span class="c1"># (Silver) &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span>  <span class="c1"># (Gray) &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># (Bright Orange) &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">153</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># (Dark Red) &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>  <span class="c1"># (Cyan) Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># (Green) Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">204</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">],</span>  <span class="c1"># (Dark Pink) Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">153</span><span class="p">],</span>  <span class="c1"># (Light Yellow) &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># (Olive Green) &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># (Bright Green) &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">153</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># (Yellowish Green) &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># (Dark Green) &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">204</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">51</span><span class="p">],</span>  <span class="c1"># (Lime Green) &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">],</span>  <span class="c1"># (Teal) &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># (Very Dark Green) &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">204</span><span class="p">],</span>  <span class="c1"># (Bright Blue) &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>  <span class="c1"># (White) &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">76</span><span class="p">],</span>  <span class="c1"># (Dark Gray) &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># (Black) &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>  <span class="c1"># (Light Purple) &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">153</span><span class="p">],</span>  <span class="c1"># (Light Orange) &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;monochrome&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># void</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">99</span><span class="p">],</span>  <span class="c1"># &#39;Landmark&#39;</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">242</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">242</span><span class="p">],</span>  <span class="c1"># &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">153</span><span class="p">],</span>  <span class="c1"># &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">204</span><span class="p">],</span>  <span class="c1"># &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">204</span><span class="p">],</span>  <span class="c1"># &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">230</span><span class="p">],</span>  <span class="c1"># &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">178</span><span class="p">],</span>  <span class="c1"># &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">127</span><span class="p">],</span>  <span class="c1"># &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">179</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">230</span><span class="p">],</span>  <span class="c1"># Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">153</span><span class="p">],</span>  <span class="c1"># Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">178</span><span class="p">],</span>  <span class="c1"># Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>  <span class="c1"># &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">204</span><span class="p">],</span>  <span class="c1"># &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">204</span><span class="p">],</span>  <span class="c1"># &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">230</span><span class="p">],</span>  <span class="c1"># &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">178</span><span class="p">],</span>  <span class="c1"># &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>  <span class="c1"># &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">178</span><span class="p">],</span>  <span class="c1"># &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">127</span><span class="p">],</span>  <span class="c1"># &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">204</span><span class="p">],</span>  <span class="c1"># &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">242</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>  <span class="c1"># &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">178</span><span class="p">],</span>  <span class="c1"># &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">127</span><span class="p">],</span>  <span class="c1"># &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">204</span><span class="p">],</span>  <span class="c1"># &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>  <span class="c1"># &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;pastel&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># void</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">217</span><span class="p">],</span>  <span class="c1"># (Pastel Pink) &#39;Landmark&#39;</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">245</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">245</span><span class="p">],</span>  <span class="c1"># (Off White) &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">173</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">230</span><span class="p">],</span>  <span class="c1"># (Pastel Blue) &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">222</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">196</span><span class="p">],</span>  <span class="c1"># (Pastel Brown) &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">211</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">226</span><span class="p">],</span>  <span class="c1"># (Pastel Gray) &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">226</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">226</span><span class="p">],</span>  <span class="c1"># (Light Gray) &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">179</span><span class="p">],</span>  <span class="c1"># (Pastel Orange) &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">204</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">166</span><span class="p">],</span>  <span class="c1"># (Pastel Red) &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">214</span><span class="p">,</span> <span class="mi">217</span><span class="p">,</span> <span class="mi">235</span><span class="p">],</span>   <span class="c1"># (Pastel Purple) Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">190</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span>   <span class="c1"># (Pastel Green) Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">235</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">],</span>   <span class="c1"># (Pastel Pink) Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">227</span><span class="p">],</span>    <span class="c1"># (Cream) &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">213</span><span class="p">,</span> <span class="mi">217</span><span class="p">,</span> <span class="mi">182</span><span class="p">],</span>    <span class="c1"># (Pastel Olive) &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">195</span><span class="p">],</span>    <span class="c1"># (Pastel Green) &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">209</span><span class="p">,</span> <span class="mi">214</span><span class="p">,</span> <span class="mi">188</span><span class="p">],</span>    <span class="c1"># (Pastel Yellow-Green) &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">195</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">168</span><span class="p">],</span>    <span class="c1"># (Light Pastel Green) &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">237</span><span class="p">,</span> <span class="mi">241</span><span class="p">,</span> <span class="mi">196</span><span class="p">],</span>    <span class="c1"># (Pastel Yellow) &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">180</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">205</span><span class="p">],</span>    <span class="c1"># (Pastel Teal) &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">176</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">190</span><span class="p">],</span>    <span class="c1"># (Darker Pastel Teal) &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">188</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">235</span><span class="p">],</span>    <span class="c1"># (Pastel Blue) &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">242</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">250</span><span class="p">],</span>   <span class="c1"># (Light Blue-White) &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">209</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">219</span><span class="p">],</span>   <span class="c1"># (Pastel Gray) &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">189</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">204</span><span class="p">],</span>   <span class="c1"># (Pastel Blue-Gray) &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">215</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">232</span><span class="p">],</span>   <span class="c1"># (Very Light Pastel Blue) &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">227</span><span class="p">],</span>   <span class="c1"># (Cream) &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;dark_mode&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># void</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">153</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">102</span><span class="p">],</span>   <span class="c1"># (Dark Pink) &#39;Landmark&#39;</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">76</span><span class="p">],</span>     <span class="c1"># (Dark Gray) &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">51</span><span class="p">],</span>     <span class="c1"># (Very Dark Blue) &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">89</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">66</span><span class="p">],</span>     <span class="c1"># (Very Dark Brown) &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">83</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">94</span><span class="p">],</span>     <span class="c1"># (Dark Gray) &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">61</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">61</span><span class="p">],</span>     <span class="c1"># (Dark Gray) &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">153</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>    <span class="c1"># (Dark Orange) &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span>     <span class="c1"># (Very Dark Red) &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">99</span><span class="p">],</span>      <span class="c1"># (Dark Purple) Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">46</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">37</span><span class="p">],</span>      <span class="c1"># (Dark Green) Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">99</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">],</span>      <span class="c1"># (Dark Pink) Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">75</span><span class="p">],</span>      <span class="c1"># (Dark Yellow) &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">61</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">31</span><span class="p">],</span>       <span class="c1"># (Dark Olive) &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">46</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">46</span><span class="p">],</span>       <span class="c1"># (Dark Green) &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">56</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">28</span><span class="p">],</span>       <span class="c1"># (Dark Yellow-Green) &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">54</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">31</span><span class="p">],</span>       <span class="c1"># (Dark Green) &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">89</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>       <span class="c1"># (Dark Yellow) &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">38</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">49</span><span class="p">],</span>       <span class="c1"># (Dark Teal) &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">26</span><span class="p">],</span>       <span class="c1"># (Very Dark Green) &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">66</span><span class="p">],</span>       <span class="c1"># (Dark Blue) &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">82</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">92</span><span class="p">],</span>      <span class="c1"># (Dark Blue-Gray) &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">46</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">56</span><span class="p">],</span>      <span class="c1"># (Dark Gray) &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">43</span><span class="p">],</span>      <span class="c1"># (Very Dark Blue) &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">56</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">82</span><span class="p">],</span>      <span class="c1"># (Dark Blue-Gray) &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">75</span><span class="p">],</span>     <span class="c1"># (Dark Yellow) &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;grayscale&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>      <span class="c1"># void (black)</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">],</span>  <span class="c1"># (Pink) &#39;Landmark&#39;,</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">240</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">240</span><span class="p">],</span> <span class="c1"># &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span>    <span class="c1"># &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">130</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">130</span><span class="p">],</span> <span class="c1"># &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span> <span class="c1"># &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="c1"># &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">170</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">170</span><span class="p">],</span> <span class="c1"># &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">],</span>    <span class="c1"># &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">190</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">190</span><span class="p">],</span>  <span class="c1"># Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>     <span class="c1"># Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">160</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">160</span><span class="p">],</span>  <span class="c1"># Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">],</span>   <span class="c1"># &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span>   <span class="c1"># &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">110</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">110</span><span class="p">],</span>   <span class="c1"># &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">115</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">115</span><span class="p">],</span>   <span class="c1"># &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>   <span class="c1"># &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">210</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">210</span><span class="p">],</span>   <span class="c1"># &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">95</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">95</span><span class="p">],</span>      <span class="c1"># &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>      <span class="c1"># &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>      <span class="c1"># &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">220</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">220</span><span class="p">],</span>  <span class="c1"># &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">140</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">140</span><span class="p">],</span>  <span class="c1"># &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>     <span class="c1"># &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">170</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">170</span><span class="p">],</span>  <span class="c1"># &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">],</span>  <span class="c1"># &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;autumn&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>          <span class="c1"># void</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">227</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">52</span><span class="p">],</span>      <span class="c1"># (Red) &#39;Landmark&#39;</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">230</span><span class="p">],</span>    <span class="c1"># (Antique White) &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">94</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">41</span><span class="p">],</span>       <span class="c1"># (Dark Red) &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">160</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>     <span class="c1"># (Medium Brown) &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">176</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">87</span><span class="p">],</span>     <span class="c1"># (Bronze) &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">205</span><span class="p">,</span> <span class="mi">186</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span>    <span class="c1"># (Tan) &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">204</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>       <span class="c1"># (Dark Orange) &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">36</span><span class="p">],</span>      <span class="c1"># (Rust) &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">222</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">135</span><span class="p">],</span>     <span class="c1"># (Tan) Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">107</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">35</span><span class="p">],</span>       <span class="c1"># (Brown) Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">165</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">79</span><span class="p">],</span>      <span class="c1"># (Copper) Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">205</span><span class="p">],</span>      <span class="c1"># (Blanched Almond) &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">133</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">99</span><span class="p">],</span>        <span class="c1"># (Brown) &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">139</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">19</span><span class="p">],</span>        <span class="c1"># (Saddle Brown) &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">160</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">45</span><span class="p">],</span>        <span class="c1"># (Sienna) &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span>        <span class="c1"># (Dark Brown) &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">228</span><span class="p">,</span> <span class="mi">196</span><span class="p">],</span>      <span class="c1"># (Bisque) &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">138</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">36</span><span class="p">],</span>        <span class="c1"># (Rust) &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">85</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">23</span><span class="p">],</span>         <span class="c1"># (Deep Brown) &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">175</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">70</span><span class="p">],</span>       <span class="c1"># (Light Brown) &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">240</span><span class="p">],</span>     <span class="c1"># (Floral White) &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">188</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">143</span><span class="p">],</span>     <span class="c1"># (Rosy Brown) &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">69</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span>        <span class="c1"># (Very Dark Brown) &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">210</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">140</span><span class="p">],</span>     <span class="c1"># (Tan) &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">205</span><span class="p">],</span>     <span class="c1"># (Blanched Almond) &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;cool&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>          <span class="c1"># void</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">180</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">205</span><span class="p">],</span>     <span class="c1"># (Purple) &#39;Landmark&#39;</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">240</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>    <span class="c1"># (Alice Blue) &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span>     <span class="c1"># (Steel Blue) &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">237</span><span class="p">],</span>    <span class="c1"># (Cornflower Blue) &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">176</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">222</span><span class="p">],</span>    <span class="c1"># (Light Steel Blue) &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">240</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>    <span class="c1"># (Azure) &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">65</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">225</span><span class="p">],</span>     <span class="c1"># (Royal Blue) &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">95</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">160</span><span class="p">],</span>     <span class="c1"># (Cadet Blue) &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">135</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">235</span><span class="p">],</span>     <span class="c1"># (Sky Blue) Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span>       <span class="c1"># (Teal) Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">127</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">212</span><span class="p">],</span>     <span class="c1"># (Aquamarine) Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">220</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">250</span><span class="p">],</span>      <span class="c1"># (Light Blue) &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">72</span><span class="p">,</span> <span class="mi">209</span><span class="p">,</span> <span class="mi">204</span><span class="p">],</span>       <span class="c1"># (Medium Turquoise) &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>        <span class="c1"># (Deep Sky Blue) &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">237</span><span class="p">],</span>      <span class="c1"># (Cornflower Blue) &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span>        <span class="c1"># (Teal) &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">175</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">],</span>      <span class="c1"># (Pale Turquoise) &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">178</span><span class="p">,</span> <span class="mi">170</span><span class="p">],</span>       <span class="c1"># (Light Sea Green) &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">112</span><span class="p">],</span>        <span class="c1"># (Midnight Blue) &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>       <span class="c1"># (Dodger Blue) &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">240</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>     <span class="c1"># (Azure) &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">119</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">153</span><span class="p">],</span>     <span class="c1"># (Light Slate Gray) &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">112</span><span class="p">],</span>       <span class="c1"># (Midnight Blue) &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">173</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">230</span><span class="p">],</span>     <span class="c1"># (Light Blue) &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">220</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">250</span><span class="p">],</span>     <span class="c1"># (Light Blue) &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;earth_tones&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>          <span class="c1"># void</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">210</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>     <span class="c1"># (Chocolate) &#39;Landmark&#39;</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">245</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">220</span><span class="p">],</span>    <span class="c1"># (Beige) &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">139</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">],</span>    <span class="c1"># (Gray) &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">160</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>     <span class="c1"># (Medium Brown) &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">169</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">169</span><span class="p">],</span>    <span class="c1"># (Dark Gray) &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">190</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span>    <span class="c1"># (Light Gray-Tan) &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">160</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">45</span><span class="p">],</span>      <span class="c1"># (Sienna) &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">139</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">19</span><span class="p">],</span>      <span class="c1"># (Saddle Brown) &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">210</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">140</span><span class="p">],</span>     <span class="c1"># (Tan) Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">85</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">47</span><span class="p">],</span>       <span class="c1"># (Dark Olive Green) Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">133</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">66</span><span class="p">],</span>       <span class="c1"># (Beaver) Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">222</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">135</span><span class="p">],</span>      <span class="c1"># (Burlywood) &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">107</span><span class="p">,</span> <span class="mi">142</span><span class="p">,</span> <span class="mi">35</span><span class="p">],</span>       <span class="c1"># (Olive Drab) &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">85</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">47</span><span class="p">],</span>        <span class="c1"># (Dark Olive Green) &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>        <span class="c1"># (Olive) &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">34</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>        <span class="c1"># (Forest Green) &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">189</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">107</span><span class="p">],</span>      <span class="c1"># (Dark Khaki) &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">143</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">143</span><span class="p">],</span>      <span class="c1"># (Dark Sea Green) &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">46</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">87</span><span class="p">],</span>        <span class="c1"># (Sea Green) &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">95</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">160</span><span class="p">],</span>       <span class="c1"># (Cadet Blue) &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">238</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span> <span class="mi">205</span><span class="p">],</span>     <span class="c1"># (Light Tan) &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">169</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">169</span><span class="p">],</span>     <span class="c1"># (Dark Gray) &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>        <span class="c1"># (Dark Gray) &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">188</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">152</span><span class="p">],</span>     <span class="c1"># (Tan) &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">222</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">135</span><span class="p">],</span>     <span class="c1"># (Burlywood) &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;vibrant&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>          <span class="c1"># void</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>      <span class="c1"># (Magenta) &#39;Landmark&#39;</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>    <span class="c1"># (White) &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>      <span class="c1"># (Deep Sky Blue) &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>      <span class="c1"># (Gold) &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">154</span><span class="p">],</span>      <span class="c1"># (Medium Spring Green) &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">211</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">211</span><span class="p">],</span>    <span class="c1"># (Light Gray) &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>       <span class="c1"># (Orange Red) &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">178</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>      <span class="c1"># (Firebrick) &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">123</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">238</span><span class="p">],</span>     <span class="c1"># (Medium Slate Blue) Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>       <span class="c1"># (Lime Green) Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">147</span><span class="p">],</span>      <span class="c1"># (Deep Pink) Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>        <span class="c1"># (Yellow) &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>          <span class="c1"># (Lime) &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>          <span class="c1"># (Green) &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">154</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>       <span class="c1"># (Yellow Green) &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">34</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>        <span class="c1"># (Forest Green) &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">127</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>        <span class="c1"># (Chartreuse) &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">208</span><span class="p">],</span>       <span class="c1"># (Turquoise) &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>          <span class="c1"># (Dark Green) &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>          <span class="c1"># (Blue) &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">240</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>     <span class="c1"># (Alice Blue) &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span>     <span class="c1"># (Gray) &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">79</span><span class="p">],</span>        <span class="c1"># (Dark Slate Gray) &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">135</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">250</span><span class="p">],</span>     <span class="c1"># (Light Sky Blue) &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">224</span><span class="p">],</span>     <span class="c1"># (Light Yellow) &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="c1"># ------------------------------------------------</span>
    <span class="c1"># NEWLY ADDED STYLISH COLOR SCHEMES BELOW:</span>
    <span class="c1"># ------------------------------------------------</span>
    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;cyberpunk&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Vibrant neon purples, pinks, and blues with deep blacks.</span>
<span class="sd">        Think futuristic city vibes and bright neon signs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>           <span class="c1"># void (keep it pitch black)</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>       <span class="c1"># (Neon Magenta) &#39;Landmark&#39;</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>     <span class="c1"># (Bright White) &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>       <span class="c1"># (Neon Cyan) &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span>       <span class="c1"># (Purple) &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>        <span class="c1"># (Dark Gray) &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">],</span>       <span class="c1"># (Dark Magenta) &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">147</span><span class="p">],</span>      <span class="c1"># (Deep Pink) &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">153</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">76</span><span class="p">],</span>        <span class="c1"># (Deep Purple-Red) &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">124</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>        <span class="c1"># (Strong Neon Purple) Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">153</span><span class="p">],</span>        <span class="c1"># (Neon Greenish Cyan) Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">],</span>        <span class="c1"># (Hot Pink) Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">153</span><span class="p">],</span>       <span class="c1"># (Pale Yellow) &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">204</span><span class="p">],</span>         <span class="c1"># (Teal) &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">153</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>        <span class="c1"># (Light Purple) &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>         <span class="c1"># (Bright Neon Blue) &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">153</span><span class="p">],</span>         <span class="c1"># (Neon Greenish Cyan) &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">204</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>         <span class="c1"># (Vivid Violet) &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>         <span class="c1"># (Neon Cyan) &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">],</span>         <span class="c1"># (Dark Teal) &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">],</span>          <span class="c1"># (Deep Indigo) &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>      <span class="c1"># (White) &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">102</span><span class="p">],</span>      <span class="c1"># (Gray) &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>            <span class="c1"># (Black) &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">204</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>       <span class="c1"># (Bright Magenta) &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">153</span><span class="p">],</span>      <span class="c1"># (Pale Yellow) &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;tropical&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bold, bright &#39;tropical vacation&#39; color palette.</span>
<span class="sd">        Lots of greens, oranges, pinks, reminiscent of island florals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>            <span class="c1"># void</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">164</span><span class="p">],</span>       <span class="c1"># (Bright Tropical Pink) &#39;Landmark&#39;</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">220</span><span class="p">],</span>      <span class="c1"># (Cornsilk) &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">136</span><span class="p">],</span>        <span class="c1"># (Teal) &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>        <span class="c1"># (Dark Orange) &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span>      <span class="c1"># (Light Peach) &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">210</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">210</span><span class="p">],</span>      <span class="c1"># (Light Gray) &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>        <span class="c1"># (Orange) &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">205</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">92</span><span class="p">],</span>        <span class="c1"># (Indian Red) &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">37</span><span class="p">],</span>        <span class="c1"># (Tropical Yellow) Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">34</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>         <span class="c1"># (Forest Green) Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">122</span><span class="p">],</span>       <span class="c1"># (Light Salmon) Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">240</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">140</span><span class="p">],</span>        <span class="c1"># (Khaki) &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">113</span><span class="p">],</span>         <span class="c1"># (Medium Sea Green) &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">46</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">87</span><span class="p">],</span>          <span class="c1"># (Sea Green) &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span>         <span class="c1"># (Coral) &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>          <span class="c1"># (Lime Green) &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">239</span><span class="p">,</span> <span class="mi">213</span><span class="p">],</span>        <span class="c1"># (Papaya Whip) &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">71</span><span class="p">],</span>          <span class="c1"># (Tomato) &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">79</span><span class="p">],</span>           <span class="c1"># (Dark Slate Gray) &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span>          <span class="c1"># (Teal) &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">224</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>       <span class="c1"># (Light Cyan) &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">218</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">214</span><span class="p">],</span>       <span class="c1"># (Orchid) &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">85</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">47</span><span class="p">],</span>         <span class="c1"># (Dark Olive Green) &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">253</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">230</span><span class="p">],</span>       <span class="c1"># (Old Lace) &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">240</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">140</span><span class="p">],</span>       <span class="c1"># (Khaki) &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;vintage&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A muted, old-photo or sepia-inspired palette </span>
<span class="sd">        for a nostalgic or antique look.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>            <span class="c1"># void</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">133</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">66</span><span class="p">],</span>        <span class="c1"># (Beaver/Brownish) &#39;Landmark&#39;</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">230</span><span class="p">],</span>      <span class="c1"># (Antique White) &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">169</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">143</span><span class="p">],</span>      <span class="c1"># (Muted Brown-Gray) &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">181</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">127</span><span class="p">],</span>      <span class="c1"># (Khaki Tan) &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">93</span><span class="p">],</span>       <span class="c1"># (Faded Gray-Brown) &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">190</span><span class="p">,</span> <span class="mi">172</span><span class="p">,</span> <span class="mi">145</span><span class="p">],</span>      <span class="c1"># (Light Brown) &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">146</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">83</span><span class="p">],</span>       <span class="c1"># (Leather Brown) &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">125</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">70</span><span class="p">],</span>        <span class="c1"># (Dusty Brick) &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">201</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">146</span><span class="p">],</span>       <span class="c1"># (Tanned Beige) Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">112</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">76</span><span class="p">],</span>         <span class="c1"># (Faded Olive-Brown) Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">172</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">114</span><span class="p">],</span>       <span class="c1"># (Light Saddle Brown) Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">222</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">166</span><span class="p">],</span>        <span class="c1"># (Light Tan) &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">131</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">83</span><span class="p">],</span>         <span class="c1"># (Brownish) &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">105</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">74</span><span class="p">],</span>          <span class="c1"># (Dark Olive Brown) &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">162</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">118</span><span class="p">],</span>        <span class="c1"># (Beige Brown) &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">95</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">65</span><span class="p">],</span>           <span class="c1"># (Muted Dark Brown) &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">212</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span>        <span class="c1"># (Off-White Tan) &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">140</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">94</span><span class="p">],</span>         <span class="c1"># (Dusky Mauve-Brown) &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">85</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span>           <span class="c1"># (Dark Taupe) &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">166</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">121</span><span class="p">],</span>        <span class="c1"># (Pale Brown) &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">235</span><span class="p">],</span>       <span class="c1"># (Light Antique White) &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">93</span><span class="p">],</span>        <span class="c1"># (Faded Gray-Brown) &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">77</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">55</span><span class="p">],</span>          <span class="c1"># (Dark Taupe) &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">203</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">162</span><span class="p">],</span>       <span class="c1"># (Light Warm Gray) &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">222</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">166</span><span class="p">],</span>       <span class="c1"># (Light Tan) &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="k">elif</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;neon_dreams&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A super-bright, high-energy neon palette.</span>
<span class="sd">        Perfect if you want a &#39;nightclub in 2080&#39; vibe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">99</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>           <span class="c1"># void</span>
            <span class="o">-</span><span class="mi">30</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>       <span class="c1"># (Magenta) &#39;Landmark&#39;</span>
            <span class="o">-</span><span class="mi">17</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>     <span class="c1"># (White) &#39;plaster&#39;</span>
            <span class="o">-</span><span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>       <span class="c1"># (Cyan) &#39;glass&#39;</span>
            <span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>       <span class="c1"># (Yellow) &#39;stone&#39;</span>
            <span class="o">-</span><span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>         <span class="c1"># (Lime) &#39;metal&#39;</span>
            <span class="o">-</span><span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span>     <span class="c1"># (Gray) &#39;concrete&#39;</span>
            <span class="o">-</span><span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>       <span class="c1"># (Neon Orange) &#39;wood&#39;</span>
            <span class="o">-</span><span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">147</span><span class="p">],</span>      <span class="c1"># (Deep Pink) &#39;brick&#39;</span>
            <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">130</span><span class="p">],</span>         <span class="c1"># (Indigo) Building</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>        <span class="c1"># (Bright Lime Green) Tree</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">153</span><span class="p">],</span>       <span class="c1"># (Neon Pink) Underground</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>         <span class="c1"># (Bright Orange) &#39;Bareland&#39;</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">153</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>         <span class="c1"># (Vivid Yellow-Green) &#39;Rangeland&#39;</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">170</span><span class="p">],</span>       <span class="c1"># (Aquamarine-ish) &#39;Shrub&#39;</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">154</span><span class="p">],</span>         <span class="c1"># (Medium Spring Green) &#39;Agriculture land&#39;</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">173</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">47</span><span class="p">],</span>        <span class="c1"># (Green-Yellow) &#39;Tree&#39;</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">127</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>         <span class="c1"># (Chartreuse) &#39;Moss and lichen&#39;</span>
            <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">208</span><span class="p">],</span>        <span class="c1"># (Turquoise) &#39;Wet land&#39;</span>
            <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span>         <span class="c1"># (Teal) &#39;Mangrove&#39;</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>           <span class="c1"># (Blue) &#39;Water&#39;</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">224</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>      <span class="c1"># (Light Cyan) &#39;Snow and ice&#39;</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">],</span>      <span class="c1"># (Silver) &#39;Developed space&#39;</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span>         <span class="c1"># (Near Black) &#39;Road&#39;</span>
            <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">130</span><span class="p">],</span>         <span class="c1"># (Indigo) &#39;Building&#39;</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>        <span class="c1"># (Bright Orange) &#39;No Data&#39;</span>
        <span class="p">}</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If an unknown color scheme is specified, return the default</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown color scheme &#39;</span><span class="si">{</span><span class="n">color_scheme</span><span class="si">}</span><span class="s2">&#39;. Using default instead.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">get_voxel_color_map</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">visualize_3d_voxel</span><span class="p">(</span><span class="n">voxel_grid</span><span class="p">,</span> <span class="n">voxel_color_map</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">voxel_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualizes 3D voxel data using matplotlib&#39;s 3D plotting capabilities.</span>
<span class="sd">    </span>
<span class="sd">    This function creates a 3D visualization of voxel data where each non-zero voxel</span>
<span class="sd">    is rendered as a colored cube. The colors are determined by the voxel values</span>
<span class="sd">    and the specified color scheme. The visualization includes proper transparency</span>
<span class="sd">    handling and aspect ratio adjustment.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    voxel_grid : numpy.ndarray</span>
<span class="sd">        3D numpy array containing voxel data. Shape should be (x, y, z) where</span>
<span class="sd">        each element represents a voxel class ID. Zero values are treated as empty space.</span>
<span class="sd">        </span>
<span class="sd">    voxel_color_map : str, optional</span>
<span class="sd">        Name of the color scheme to use for voxel coloring. Default is &#39;default&#39;.</span>
<span class="sd">        See get_voxel_color_map() for available options.</span>
<span class="sd">        </span>
<span class="sd">    voxel_size : float, optional</span>
<span class="sd">        Physical size of each voxel in meters. Used for z-axis scaling and labels.</span>
<span class="sd">        Default is 2.0 meters.</span>
<span class="sd">        </span>
<span class="sd">    save_path : str, optional</span>
<span class="sd">        File path to save the generated plot. If None, the plot is only displayed.</span>
<span class="sd">        Default is None.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        The function displays the plot and optionally saves it to file.</span>
<span class="sd">        </span>
<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - Void voxels (value -99) are rendered transparent</span>
<span class="sd">    - Underground voxels (value -1) and trees (value -2) have reduced transparency</span>
<span class="sd">    - Z-axis ticks are automatically scaled to show real-world heights</span>
<span class="sd">    - The plot aspect ratio is adjusted to maintain proper voxel proportions</span>
<span class="sd">    - For large voxel grids, this function may be slow due to matplotlib&#39;s 3D rendering</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">    ---------</span>
<span class="sd">    &gt;&gt;&gt; # Basic visualization</span>
<span class="sd">    &gt;&gt;&gt; visualize_3d_voxel(voxel_array)</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # Use cyberpunk color scheme and save to file</span>
<span class="sd">    &gt;&gt;&gt; visualize_3d_voxel(voxel_array, &#39;cyberpunk&#39;, save_path=&#39;city_view.png&#39;)</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # Adjust voxel size for different scale</span>
<span class="sd">    &gt;&gt;&gt; visualize_3d_voxel(voxel_array, voxel_size=1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the color mapping for the specified scheme</span>
    <span class="n">color_map</span> <span class="o">=</span> <span class="n">get_voxel_color_map</span><span class="p">(</span><span class="n">voxel_color_map</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Visualizing 3D voxel data&quot;</span><span class="p">)</span>
    <span class="c1"># Create a figure and a 3D axis</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Processing voxels...&quot;</span><span class="p">)</span>
    <span class="c1"># Create boolean mask for voxels that should be rendered (non-zero values)</span>
    <span class="n">filled_voxels</span> <span class="o">=</span> <span class="n">voxel_grid</span> <span class="o">!=</span> <span class="mi">0</span>
    
    <span class="c1"># Initialize color array with RGBA values (Red, Green, Blue, Alpha)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="p">,))</span>  <span class="c1"># RGBA</span>

    <span class="c1"># Process each possible voxel value and assign colors</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="mi">15</span><span class="p">):</span>  <span class="c1"># Updated range to include -3 and -2</span>
        <span class="c1"># Create mask for voxels with this specific value</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">voxel_grid</span> <span class="o">==</span> <span class="n">val</span>
        
        <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">color_map</span><span class="p">:</span>
            <span class="c1"># Convert RGB values from [0,255] to [0,1] range for matplotlib</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">/</span><span class="mi">255</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">color_map</span><span class="p">[</span><span class="n">val</span><span class="p">]]</span>  <span class="c1"># Normalize RGB values to [0, 1]</span>
            
            <span class="c1"># Set transparency based on voxel type</span>
            <span class="c1"># alpha = 0.7 if ((val == -1) or (val == -2)) else 0.9  # More transparent for underground and below</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="o">-</span><span class="mi">99</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>  <span class="c1"># Void voxels are completely transparent</span>
            <span class="c1"># alpha = 1</span>
            
            <span class="c1"># Assign RGBA color to all voxels of this type</span>
            <span class="n">colors</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgb</span> <span class="o">+</span> <span class="p">[</span><span class="n">alpha</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Default color for undefined voxel types</span>
            <span class="n">colors</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>  <span class="c1"># Default color if not in color_map</span>

    <span class="c1"># Render voxels with progress bar</span>
    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">voxels</span><span class="p">(</span><span class="n">filled_voxels</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

    <span class="c1"># print(&quot;Finalizing plot...&quot;)</span>
    <span class="c1"># Set labels and title</span>
    <span class="c1"># ax.set_xlabel(&#39;X&#39;)</span>
    <span class="c1"># ax.set_ylabel(&#39;Y&#39;)</span>
    <span class="c1"># ax.set_zlabel(&#39;Z (meters)&#39;)</span>
    <span class="c1"># ax.set_title(&#39;3D Voxel Visualization&#39;)</span>

    <span class="c1"># Configure z-axis ticks to show meaningful height values</span>
    <span class="c1"># Adjust z-axis ticks to show every 10 cells or less</span>
    <span class="n">z_max</span> <span class="o">=</span> <span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">z_max</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">z_ticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">z_ticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        
    <span class="c1"># Remove axes for cleaner appearance</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="c1"># ax.set_zticks(z_ticks)</span>
    <span class="c1"># ax.set_zticklabels([f&quot;{z * voxel_size:.1f}&quot; for z in z_ticks])</span>

    <span class="c1"># Set aspect ratio to be equal for realistic proportions</span>
    <span class="n">max_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">max_range</span><span class="p">,</span> <span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">max_range</span><span class="p">,</span> <span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">max_range</span><span class="p">))</span>

    <span class="c1"># Set z-axis limits to focus on the relevant height range</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

    <span class="c1"># print(&quot;Visualization complete. Displaying plot...&quot;)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Save plot if path is provided</span>
    <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_3d_voxel_plotly</span><span class="p">(</span><span class="n">voxel_grid</span><span class="p">,</span> <span class="n">voxel_color_map</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">voxel_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an interactive 3D visualization of voxel data using Plotly.</span>
<span class="sd">    </span>
<span class="sd">    This function generates an interactive 3D visualization using Plotly&#39;s Mesh3d</span>
<span class="sd">    and Scatter3d objects. Each voxel is rendered as a cube with proper lighting</span>
<span class="sd">    and edge visualization. The resulting plot supports interactive rotation,</span>
<span class="sd">    zooming, and panning.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    voxel_grid : numpy.ndarray</span>
<span class="sd">        3D numpy array containing voxel data. Shape should be (x, y, z) where</span>
<span class="sd">        each element represents a voxel class ID. Zero values are treated as empty space.</span>
<span class="sd">        </span>
<span class="sd">    voxel_color_map : str, optional</span>
<span class="sd">        Name of the color scheme to use for voxel coloring. Default is &#39;default&#39;.</span>
<span class="sd">        See get_voxel_color_map() for available options.</span>
<span class="sd">        </span>
<span class="sd">    voxel_size : float, optional</span>
<span class="sd">        Physical size of each voxel in meters. Used for z-axis scaling and labels.</span>
<span class="sd">        Default is 2.0 meters.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        The function displays the interactive plot in the browser or notebook.</span>
<span class="sd">        </span>
<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - Creates individual cube geometries for each non-zero voxel</span>
<span class="sd">    - Includes edge lines for better visual definition</span>
<span class="sd">    - Uses orthographic projection for technical visualization</span>
<span class="sd">    - May be slow for very large voxel grids due to individual cube generation</span>
<span class="sd">    - Lighting is optimized for clear visualization of building structures</span>
<span class="sd">    </span>
<span class="sd">    Technical Details:</span>
<span class="sd">    ------------------</span>
<span class="sd">    - Each cube is defined by 8 vertices and 12 triangular faces</span>
<span class="sd">    - Edge lines are generated separately for visual clarity</span>
<span class="sd">    - Color mapping follows the same convention as matplotlib version</span>
<span class="sd">    - Camera is positioned for isometric view with orthographic projection</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">    ---------</span>
<span class="sd">    &gt;&gt;&gt; # Basic interactive visualization</span>
<span class="sd">    &gt;&gt;&gt; visualize_3d_voxel_plotly(voxel_array)</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # Use high contrast colors for better visibility</span>
<span class="sd">    &gt;&gt;&gt; visualize_3d_voxel_plotly(voxel_array, &#39;high_contrast&#39;)</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # Adjust scale for different voxel sizes</span>
<span class="sd">    &gt;&gt;&gt; visualize_3d_voxel_plotly(voxel_array, voxel_size=1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the color mapping for the specified scheme</span>
    <span class="n">color_map</span> <span class="o">=</span> <span class="n">get_voxel_color_map</span><span class="p">(</span><span class="n">voxel_color_map</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Preparing visualization...&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing voxels...&quot;</span><span class="p">)</span>
    <span class="c1"># Initialize lists to store mesh data</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># Vertex coordinates</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># Face indices (triangles)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>           <span class="c1"># Vertex colors</span>
    <span class="n">edge_x</span><span class="p">,</span> <span class="n">edge_y</span><span class="p">,</span> <span class="n">edge_z</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># Edge line coordinates</span>
    <span class="n">vertex_index</span> <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># Current vertex index counter</span>

    <span class="c1"># Define cube faces using vertex indices</span>
    <span class="c1"># Each cube has 12 triangular faces (2 per square face)</span>
    <span class="n">cube_i</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">cube_j</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">cube_k</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>

    <span class="c1"># Process each voxel in the grid</span>
    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">zi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="c1"># Only process non-zero voxels</span>
                    <span class="k">if</span> <span class="n">voxel_grid</span><span class="p">[</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># Define the 8 vertices of a unit cube at this position</span>
                        <span class="c1"># Vertices are ordered: bottom face (z), then top face (z+1)</span>
                        <span class="n">cube_vertices</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="p">[</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="p">],</span> <span class="p">[</span><span class="n">xi</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="p">],</span> <span class="p">[</span><span class="n">xi</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">yi</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">zi</span><span class="p">],</span> <span class="p">[</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">zi</span><span class="p">],</span>        <span class="c1"># Bottom face</span>
                            <span class="p">[</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">xi</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">xi</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">yi</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">zi</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">zi</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Top face</span>
                        <span class="p">]</span>
                        
                        <span class="c1"># Add vertex coordinates to the mesh data</span>
                        <span class="n">x</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cube_vertices</span><span class="p">])</span>
                        <span class="n">y</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cube_vertices</span><span class="p">])</span>
                        <span class="n">z</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cube_vertices</span><span class="p">])</span>

                        <span class="c1"># Add face indices (offset by current vertex_index)</span>
                        <span class="n">i</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">x</span> <span class="o">+</span> <span class="n">vertex_index</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cube_i</span><span class="p">])</span>
                        <span class="n">j</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">x</span> <span class="o">+</span> <span class="n">vertex_index</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cube_j</span><span class="p">])</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">x</span> <span class="o">+</span> <span class="n">vertex_index</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cube_k</span><span class="p">])</span>

                        <span class="c1"># Get color for this voxel type and replicate for all 8 vertices</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="n">color_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">voxel_grid</span><span class="p">[</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                        <span class="n">colors</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">color</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>

                        <span class="c1"># Generate edge lines for visual clarity</span>
                        <span class="c1"># Define the 12 edges of a cube (4 bottom + 4 top + 4 vertical)</span>
                        <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>  <span class="c1"># Bottom face edges</span>
                            <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>  <span class="c1"># Top face edges</span>
                            <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>   <span class="c1"># Vertical edges</span>
                        <span class="p">]</span>
                        
                        <span class="c1"># Add edge coordinates (None creates line breaks between edges)</span>
                        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                            <span class="n">edge_x</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">cube_vertices</span><span class="p">[</span><span class="n">start</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_vertices</span><span class="p">[</span><span class="n">end</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span>
                            <span class="n">edge_y</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">cube_vertices</span><span class="p">[</span><span class="n">start</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">cube_vertices</span><span class="p">[</span><span class="n">end</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span>
                            <span class="n">edge_z</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">cube_vertices</span><span class="p">[</span><span class="n">start</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">cube_vertices</span><span class="p">[</span><span class="n">end</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span>

                        <span class="c1"># Increment vertex index for next cube</span>
                        <span class="n">vertex_index</span> <span class="o">+=</span> <span class="mi">8</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating Plotly figure...&quot;</span><span class="p">)</span>
    <span class="c1"># Create 3D mesh object with vertices, faces, and colors</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Mesh3d</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
        <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
        <span class="n">vertexcolor</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
        <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">flatshading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Voxel Grid&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Configure lighting for better visualization</span>
    <span class="c1"># Add lighting to the mesh</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">lighting</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ambient</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>      <span class="c1"># Ambient light (overall brightness)</span>
                      <span class="n">diffuse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>        <span class="c1"># Diffuse light (surface shading)</span>
                      <span class="n">fresnel</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>      <span class="c1"># Fresnel effect (edge highlighting)</span>
                      <span class="n">specular</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>       <span class="c1"># Specular highlights</span>
                      <span class="n">roughness</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>   <span class="c1"># Surface roughness</span>
                      <span class="n">facenormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span>
                      <span class="n">vertexnormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">),</span>
        <span class="n">lightposition</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>       <span class="c1"># Light source position</span>
                           <span class="n">y</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                           <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Create edge lines for better visual definition</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">edge_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">edge_y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">edge_z</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Edges&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Combine mesh and edges into a figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">mesh</span><span class="p">,</span> <span class="n">edges</span><span class="p">])</span>

    <span class="c1"># Configure plot layout and camera settings</span>
    <span class="c1"># Set labels, title, and use orthographic projection</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
            <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>
            <span class="n">zaxis_title</span><span class="o">=</span><span class="s1">&#39;Z (meters)&#39;</span><span class="p">,</span>
            <span class="n">aspectmode</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>          <span class="c1"># Maintain data aspect ratios</span>
            <span class="n">camera</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">projection</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;orthographic&quot;</span><span class="p">)</span>  <span class="c1"># Use orthographic projection</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Voxel Visualization&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Configure z-axis to show real-world heights</span>
    <span class="c1"># Adjust z-axis ticks to show every 10 cells or less</span>
    <span class="n">z_max</span> <span class="o">=</span> <span class="n">voxel_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">z_max</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">z_ticks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">z_ticks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Update z-axis with meaningful height labels</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">tickvals</span><span class="o">=</span><span class="n">z_ticks</span><span class="p">,</span>
                <span class="n">ticktext</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">voxel_size</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">z_ticks</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Visualization complete. Displaying plot...&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">adjusted_meshsize</span><span class="p">,</span> <span class="n">u_vec</span><span class="p">,</span> <span class="n">v_vec</span><span class="p">,</span> <span class="n">transformer</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="s1">&#39;CartoDB light&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Core function for plotting 2D grid data overlaid on basemaps.</span>
<span class="sd">    </span>
<span class="sd">    This function handles the visualization of various types of grid data by creating</span>
<span class="sd">    colored polygons for each grid cell and overlaying them on a web basemap. It supports</span>
<span class="sd">    different data types with appropriate color schemes and handles special values like</span>
<span class="sd">    NaN and zero appropriately.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    grid : numpy.ndarray</span>
<span class="sd">        2D array containing the grid data values to visualize.</span>
<span class="sd">        </span>
<span class="sd">    origin : numpy.ndarray</span>
<span class="sd">        Geographic coordinates [lon, lat] of the grid&#39;s origin point.</span>
<span class="sd">        </span>
<span class="sd">    adjusted_meshsize : float</span>
<span class="sd">        Size of each grid cell in meters after grid size adjustments.</span>
<span class="sd">        </span>
<span class="sd">    u_vec, v_vec : numpy.ndarray</span>
<span class="sd">        Unit vectors defining the grid orientation in geographic space.</span>
<span class="sd">        </span>
<span class="sd">    transformer : pyproj.Transformer</span>
<span class="sd">        Coordinate transformer for converting between geographic and projected coordinates.</span>
<span class="sd">        </span>
<span class="sd">    vertices : list</span>
<span class="sd">        List of [lon, lat] coordinates defining the grid boundary.</span>
<span class="sd">        </span>
<span class="sd">    data_type : str</span>
<span class="sd">        Type of data being visualized. Supported types:</span>
<span class="sd">        - &#39;land_cover&#39;: Land use/land cover classifications</span>
<span class="sd">        - &#39;building_height&#39;: Building height values</span>
<span class="sd">        - &#39;dem&#39;: Digital elevation model</span>
<span class="sd">        - &#39;canopy_height&#39;: Vegetation height</span>
<span class="sd">        - &#39;green_view_index&#39;: Green visibility index</span>
<span class="sd">        - &#39;sky_view_index&#39;: Sky visibility factor</span>
<span class="sd">        </span>
<span class="sd">    vmin, vmax : float, optional</span>
<span class="sd">        Min/max values for color scaling. Auto-calculated if not provided.</span>
<span class="sd">        </span>
<span class="sd">    color_map : str, optional</span>
<span class="sd">        Matplotlib colormap name to override default schemes.</span>
<span class="sd">        </span>
<span class="sd">    alpha : float, optional</span>
<span class="sd">        Transparency of grid overlay (0-1). Default is 0.5.</span>
<span class="sd">        </span>
<span class="sd">    buf : float, optional</span>
<span class="sd">        Buffer around grid for plot extent as fraction of grid size. Default is 0.2.</span>
<span class="sd">        </span>
<span class="sd">    edge : bool, optional</span>
<span class="sd">        Whether to draw cell edges. Default is True.</span>
<span class="sd">        </span>
<span class="sd">    basemap : str, optional</span>
<span class="sd">        Basemap style name. Default is &#39;CartoDB light&#39;.</span>
<span class="sd">        </span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Additional parameters specific to data types:</span>
<span class="sd">        - land_cover_classes: Dictionary for land cover data</span>
<span class="sd">        - buildings: List of building polygons for building_height data</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        Displays the plot with matplotlib.</span>
<span class="sd">        </span>
<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - Grid is transposed to match geographic orientation</span>
<span class="sd">    - Special handling for NaN, zero, and negative values depending on data type</span>
<span class="sd">    - Basemap is added using contextily for geographic context</span>
<span class="sd">    - Plot extent is automatically calculated from grid vertices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create matplotlib figure and axis</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

    <span class="c1"># Configure visualization parameters based on data type</span>
    <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;land_cover&#39;</span><span class="p">:</span>
        <span class="c1"># Land cover uses discrete color categories</span>
        <span class="n">land_cover_classes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;land_cover_classes&#39;</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">mcolors</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;#</span><span class="si">{</span><span class="n">r</span><span class="si">:</span><span class="s1">02x</span><span class="si">}{</span><span class="n">g</span><span class="si">:</span><span class="s1">02x</span><span class="si">}{</span><span class="n">b</span><span class="si">:</span><span class="s1">02x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">land_cover_classes</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">land_cover_classes</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Grid Cells with Dominant Land Cover Classes&#39;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Land Cover Class&#39;</span>
        <span class="n">tick_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">land_cover_classes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        
    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;building_height&#39;</span><span class="p">:</span>
        <span class="c1"># Building height uses continuous colormap with special handling for zero/NaN</span>
        <span class="c1"># Create a masked array to handle special values</span>
        <span class="n">masked_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">grid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)))</span>

        <span class="c1"># Set up colormap and normalization for positive values</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span>
        <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">masked_grid</span><span class="p">[</span><span class="n">masked_grid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">masked_grid</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Grid Cells with Building Heights&#39;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Building Height (m)&#39;</span>
        <span class="n">tick_labels</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;dem&#39;</span><span class="p">:</span>
        <span class="c1"># Digital elevation model uses terrain colormap</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">terrain</span>
        <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;DEM Grid Overlaid on Map&#39;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Elevation (m)&#39;</span>
        <span class="n">tick_labels</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;canopy_height&#39;</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Greens</span>
        <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Canopy Height Grid Overlaid on Map&#39;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Canopy Height (m)&#39;</span>
        <span class="n">tick_labels</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;green_view_index&#39;</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Greens</span>
        <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Green View Index Grid Overlaid on Map&#39;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Green View Index&#39;</span>
        <span class="n">tick_labels</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;sky_view_index&#39;</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;BuPu_r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Sky View Index Grid Overlaid on Map&#39;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sky View Index&#39;</span>
        <span class="n">tick_labels</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span>
        <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">tick_labels</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">if</span> <span class="n">color_map</span><span class="p">:</span>
        <span class="c1"># cmap = plt.cm.get_cmap(color_map).copy()</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">color_map</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Ensure grid is in the correct orientation</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">T</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">create_cell_polygon</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">adjusted_meshsize</span><span class="p">,</span> <span class="n">u_vec</span><span class="p">,</span> <span class="n">v_vec</span><span class="p">)</span>  <span class="c1"># Note the swap of i and j</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span> <span class="k">for</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)])</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;building_height&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="c1"># White fill for NaN values</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;black&#39;</span> <span class="k">if</span> <span class="n">edge</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># No fill for zero values, only edges if enabled</span>
                    <span class="k">if</span> <span class="n">edge</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Viridis colormap for positive values</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;black&#39;</span> <span class="k">if</span> <span class="n">edge</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;canopy_height&#39;</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># No fill for zero values, only edges if enabled</span>
                    <span class="k">if</span> <span class="n">edge</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">edge</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;view&#39;</span> <span class="ow">in</span> <span class="n">data_type</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="c1"># No fill for zero values, only edges if enabled</span>
                    <span class="k">if</span> <span class="n">edge</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Viridis colormap for positive values</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;black&#39;</span> <span class="k">if</span> <span class="n">edge</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">edge</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">crs_epsg_3857</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">3857</span><span class="p">)</span>

    <span class="n">basemaps</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;CartoDB dark&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">DarkMatter</span><span class="p">,</span>  <span class="c1"># Popular dark option</span>
      <span class="s1">&#39;CartoDB light&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Positron</span><span class="p">,</span>  <span class="c1"># Popular dark option</span>
      <span class="s1">&#39;CartoDB voyager&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Voyager</span><span class="p">,</span>  <span class="c1"># Popular dark option</span>
      <span class="s1">&#39;CartoDB light no labels&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">PositronNoLabels</span><span class="p">,</span>  <span class="c1"># Popular dark option</span>
      <span class="s1">&#39;CartoDB dark no labels&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">DarkMatterNoLabels</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs_epsg_3857</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">basemaps</span><span class="p">[</span><span class="n">basemap</span><span class="p">])</span>
    <span class="c1"># if basemap == &quot;dark&quot;:</span>
    <span class="c1">#     ctx.add_basemap(ax, crs=crs_epsg_3857, source=ctx.providers.CartoDB.DarkMatter)</span>
    <span class="c1"># elif basemap == &#39;light&#39;:</span>
    <span class="c1">#     ctx.add_basemap(ax, crs=crs_epsg_3857, source=ctx.providers.CartoDB.Positron)</span>
    <span class="c1"># elif basemap == &#39;voyager&#39;:</span>
    <span class="c1">#     ctx.add_basemap(ax, crs=crs_epsg_3857, source=ctx.providers.CartoDB.Voyager)</span>

    <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;building_height&#39;</span><span class="p">:</span>
        <span class="n">buildings</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;buildings&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">building</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
            <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">building</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span> <span class="k">for</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
            <span class="c1"># print(polygon)</span>

    <span class="c1"># Safe calculation of plot limits</span>
    <span class="n">all_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span> <span class="k">for</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">all_coords</span><span class="p">])</span>

    <span class="c1"># Calculate limits safely</span>
    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x_min</span> <span class="o">!=</span> <span class="n">x_max</span> <span class="ow">and</span> <span class="n">y_min</span> <span class="o">!=</span> <span class="n">y_max</span> <span class="ow">and</span> <span class="n">buf</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dist_x</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span>
        <span class="n">dist_y</span> <span class="o">=</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span>
        <span class="c1"># Set limits with buffer</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_min</span> <span class="o">-</span> <span class="n">buf</span> <span class="o">*</span> <span class="n">dist_x</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">+</span> <span class="n">buf</span> <span class="o">*</span> <span class="n">dist_x</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_min</span> <span class="o">-</span> <span class="n">buf</span> <span class="o">*</span> <span class="n">dist_y</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">+</span> <span class="n">buf</span> <span class="o">*</span> <span class="n">dist_y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If coordinates are the same or buffer is 0, set limits without buffer</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">display_builing_ids_on_map</span><span class="p">(</span><span class="n">building_geojson</span><span class="p">,</span> <span class="n">rectangle_vertices</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an interactive folium map displaying building footprints with selectable IDs.</span>
<span class="sd">    </span>
<span class="sd">    This function generates a web map showing building polygons within a circular area</span>
<span class="sd">    around the center of the specified rectangle. Each building is labeled with its</span>
<span class="sd">    ID and additional information, making it easy to identify specific buildings</span>
<span class="sd">    for analysis or selection.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    building_geojson : list</span>
<span class="sd">        List of GeoJSON feature dictionaries representing building polygons.</span>
<span class="sd">        Each feature should have:</span>
<span class="sd">        - &#39;geometry&#39;: GeoJSON polygon geometry</span>
<span class="sd">        - &#39;properties&#39;: Dictionary with &#39;id&#39; and optional &#39;name&#39; fields</span>
<span class="sd">        </span>
<span class="sd">    rectangle_vertices : list</span>
<span class="sd">        List of [lat, lon] coordinate pairs defining the area of interest.</span>
<span class="sd">        Used to calculate the map center and intersection area.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    folium.Map</span>
<span class="sd">        Interactive folium map object with building polygons and labels.</span>
<span class="sd">        </span>
<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - Only buildings intersecting with a 200m radius circle are displayed</span>
<span class="sd">    - Building IDs are displayed as selectable text labels</span>
<span class="sd">    - Map is automatically centered on the rectangle vertices</span>
<span class="sd">    - Popup information includes building ID and name (if available)</span>
<span class="sd">    - Building polygons are styled with blue color and semi-transparent fill</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">    ---------</span>
<span class="sd">    &gt;&gt;&gt; vertices = [[40.7580, -73.9855], [40.7590, -73.9855], </span>
<span class="sd">    ...             [40.7590, -73.9845], [40.7580, -73.9845]]</span>
<span class="sd">    &gt;&gt;&gt; buildings = [{&#39;geometry&#39;: {...}, &#39;properties&#39;: {&#39;id&#39;: &#39;123&#39;, &#39;name&#39;: &#39;Building A&#39;}}]</span>
<span class="sd">    &gt;&gt;&gt; map_obj = display_builing_ids_on_map(buildings, vertices)</span>
<span class="sd">    &gt;&gt;&gt; map_obj.save(&#39;buildings_map.html&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Parse the GeoJSON data</span>
    <span class="n">geojson_data</span> <span class="o">=</span> <span class="n">building_geojson</span>

    <span class="c1"># Calculate the center point of the rectangle for map centering</span>
    <span class="c1"># Extract all latitudes and longitudes</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">rectangle_vertices</span><span class="p">]</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">rectangle_vertices</span><span class="p">]</span>
    
    <span class="c1"># Calculate center by averaging min and max values</span>
    <span class="n">center_lat</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">center_lon</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Create circle polygon for intersection testing (200m radius)</span>
    <span class="n">circle</span> <span class="o">=</span> <span class="n">create_circle_polygon</span><span class="p">(</span><span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="c1"># Create a map centered on the data</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

    <span class="c1"># Process each building feature</span>
    <span class="c1"># Add building footprints to the map</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">geojson_data</span><span class="p">:</span>
        <span class="c1"># Convert coordinates if needed</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">convert_coordinates</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">building_polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        
        <span class="c1"># Only process buildings that intersect with the circular area</span>
        <span class="c1"># Check if building intersects with circle</span>
        <span class="k">if</span> <span class="n">building_polygon</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">circle</span><span class="p">):</span>
            <span class="c1"># Extract building information from properties</span>
            <span class="c1"># Get and format building properties</span>
            <span class="c1"># building_id = format_building_id(feature[&#39;properties&#39;].get(&#39;id&#39;, 0))</span>
            <span class="n">building_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">building_name</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name:en&#39;</span><span class="p">,</span> 
                                                    <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Building </span><span class="si">{</span><span class="n">building_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
            
            <span class="c1"># Create popup content with selectable ID</span>
            <span class="n">popup_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div&gt;</span>
<span class="s2">                Building ID: &lt;span style=&quot;user-select: all&quot;&gt;</span><span class="si">{</span><span class="n">building_id</span><span class="si">}</span><span class="s2">&lt;/span&gt;&lt;br&gt;</span>
<span class="s2">                Name: </span><span class="si">{</span><span class="n">building_name</span><span class="si">}</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
            
            <span class="c1"># Add building polygon to map with popup information</span>
            <span class="c1"># Add polygon to map</span>
            <span class="n">folium</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span>
                <span class="n">locations</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span>
                <span class="n">popup</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="n">popup_content</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                <span class="n">weight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                <span class="n">fill_opacity</span><span class="o">=</span><span class="mf">0.2</span>
            <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            
            <span class="c1"># Add building ID label at the polygon centroid</span>
            <span class="c1"># Calculate centroid for label placement</span>
            <span class="n">centroid</span> <span class="o">=</span> <span class="n">calculate_centroid</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
            
            <span class="c1"># Add building ID as a selectable label</span>
            <span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span>
                <span class="n">centroid</span><span class="p">,</span>
                <span class="n">icon</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">DivIcon</span><span class="p">(</span>
                    <span class="n">html</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                    &lt;div style=&quot;</span>
<span class="s1">                        position: relative;</span>
<span class="s1">                        font-family: monospace;</span>
<span class="s1">                        font-size: 12px;</span>
<span class="s1">                        color: black;</span>
<span class="s1">                        background-color: rgba(255, 255, 255, 0.9);</span>
<span class="s1">                        padding: 5px 8px;</span>
<span class="s1">                        margin: -10px -15px;</span>
<span class="s1">                        border: 1px solid black;</span>
<span class="s1">                        border-radius: 4px;</span>
<span class="s1">                        user-select: all;</span>
<span class="s1">                        cursor: text;</span>
<span class="s1">                        white-space: nowrap;</span>
<span class="s1">                        display: inline-block;</span>
<span class="s1">                        box-shadow: 0 0 3px rgba(0,0,0,0.2);</span>
<span class="s1">                    &quot;&gt;</span><span class="si">{</span><span class="n">building_id</span><span class="si">}</span><span class="s1">&lt;/div&gt;</span>
<span class="s1">                    &#39;&#39;&#39;</span><span class="p">,</span>
                    <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;building-label&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="c1"># Save the map</span>
    <span class="k">return</span> <span class="n">m</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_land_cover_grid_on_map</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">rectangle_vertices</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;Urbanwatch&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="s1">&#39;CartoDB light&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualizes land cover classification grid overlaid on a basemap.</span>
<span class="sd">    </span>
<span class="sd">    This function creates a map visualization of land cover data using predefined</span>
<span class="sd">    color schemes for different land cover classes. Each grid cell is colored</span>
<span class="sd">    according to its dominant land cover type and overlaid on a web basemap</span>
<span class="sd">    for geographic context.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    grid : numpy.ndarray</span>
<span class="sd">        2D array containing land cover class indices. Values should correspond</span>
<span class="sd">        to indices in the land cover classification system.</span>
<span class="sd">        </span>
<span class="sd">    rectangle_vertices : list</span>
<span class="sd">        List of [lon, lat] coordinate pairs defining the grid boundary corners.</span>
<span class="sd">        Should contain exactly 4 vertices in geographic coordinates.</span>
<span class="sd">        </span>
<span class="sd">    meshsize : float</span>
<span class="sd">        Target size of each grid cell in meters. May be adjusted during processing.</span>
<span class="sd">        </span>
<span class="sd">    source : str, optional</span>
<span class="sd">        Source of land cover classification system. Default is &#39;Urbanwatch&#39;.</span>
<span class="sd">        See get_land_cover_classes() for available options.</span>
<span class="sd">        </span>
<span class="sd">    vmin, vmax : float, optional</span>
<span class="sd">        Not used for land cover (discrete categories). Included for API consistency.</span>
<span class="sd">        </span>
<span class="sd">    alpha : float, optional</span>
<span class="sd">        Transparency of grid overlay (0-1). Default is 0.5.</span>
<span class="sd">        </span>
<span class="sd">    buf : float, optional</span>
<span class="sd">        Buffer around grid for plot extent as fraction of grid size. Default is 0.2.</span>
<span class="sd">        </span>
<span class="sd">    edge : bool, optional</span>
<span class="sd">        Whether to draw cell edges. Default is True.</span>
<span class="sd">        </span>
<span class="sd">    basemap : str, optional</span>
<span class="sd">        Basemap style name. Options include:</span>
<span class="sd">        - &#39;CartoDB light&#39; (default)</span>
<span class="sd">        - &#39;CartoDB dark&#39;</span>
<span class="sd">        - &#39;CartoDB voyager&#39;</span>
<span class="sd">        Default is &#39;CartoDB light&#39;.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        Displays the plot and prints information about unique land cover classes.</span>
<span class="sd">        </span>
<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - Grid coordinates are calculated using geodetic calculations</span>
<span class="sd">    - Land cover classes are mapped to predefined colors</span>
<span class="sd">    - Unique classes present in the grid are printed for reference</span>
<span class="sd">    - Uses Web Mercator projection (EPSG:3857) for basemap compatibility</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">    ---------</span>
<span class="sd">    &gt;&gt;&gt; # Basic land cover visualization</span>
<span class="sd">    &gt;&gt;&gt; vertices = [[lon1, lat1], [lon2, lat2], [lon3, lat3], [lon4, lat4]]</span>
<span class="sd">    &gt;&gt;&gt; visualize_land_cover_grid_on_map(lc_grid, vertices, 10.0)</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # With custom styling</span>
<span class="sd">    &gt;&gt;&gt; visualize_land_cover_grid_on_map(lc_grid, vertices, 10.0, </span>
<span class="sd">    ...                                  alpha=0.7, edge=False, </span>
<span class="sd">    ...                                  basemap=&#39;CartoDB dark&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize geodetic calculator for distance measurements</span>
    <span class="n">geod</span> <span class="o">=</span> <span class="n">initialize_geod</span><span class="p">()</span>

    <span class="c1"># Get land cover class definitions and colors</span>
    <span class="n">land_cover_classes</span> <span class="o">=</span> <span class="n">get_land_cover_classes</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

    <span class="c1"># Extract key vertices for grid calculations</span>
    <span class="n">vertex_0</span> <span class="o">=</span> <span class="n">rectangle_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vertex_1</span> <span class="o">=</span> <span class="n">rectangle_vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">vertex_3</span> <span class="o">=</span> <span class="n">rectangle_vertices</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="c1"># Calculate distances between vertices using geodetic calculations</span>
    <span class="n">dist_side_1</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="n">geod</span><span class="p">,</span> <span class="n">vertex_0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertex_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertex_1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertex_1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">dist_side_2</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="n">geod</span><span class="p">,</span> <span class="n">vertex_0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertex_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertex_3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertex_3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Calculate side vectors in geographic coordinates</span>
    <span class="n">side_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_0</span><span class="p">)</span>
    <span class="n">side_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_0</span><span class="p">)</span>

    <span class="c1"># Create normalized unit vectors for grid orientation</span>
    <span class="n">u_vec</span> <span class="o">=</span> <span class="n">normalize_to_one_meter</span><span class="p">(</span><span class="n">side_1</span><span class="p">,</span> <span class="n">dist_side_1</span><span class="p">)</span>
    <span class="n">v_vec</span> <span class="o">=</span> <span class="n">normalize_to_one_meter</span><span class="p">(</span><span class="n">side_2</span><span class="p">,</span> <span class="n">dist_side_2</span><span class="p">)</span>

    <span class="c1"># Set grid origin and calculate optimal grid size</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rectangle_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">grid_size</span><span class="p">,</span> <span class="n">adjusted_meshsize</span> <span class="o">=</span> <span class="n">calculate_grid_size</span><span class="p">(</span><span class="n">side_1</span><span class="p">,</span> <span class="n">side_2</span><span class="p">,</span> <span class="n">u_vec</span><span class="p">,</span> <span class="n">v_vec</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calculated grid size: </span><span class="si">{</span><span class="n">grid_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># print(f&quot;Adjusted mesh size: {adjusted_meshsize}&quot;)</span>

    <span class="c1"># Set up coordinate transformation for basemap compatibility</span>
    <span class="n">geotiff_crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">3857</span><span class="p">)</span>
    <span class="n">transformer</span> <span class="o">=</span> <span class="n">setup_transformer</span><span class="p">(</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span> <span class="n">geotiff_crs</span><span class="p">)</span>

    <span class="c1"># Generate grid cell coordinates (not currently used but available for advanced processing)</span>
    <span class="n">cell_coords</span> <span class="o">=</span> <span class="n">create_coordinate_mesh</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">,</span> <span class="n">adjusted_meshsize</span><span class="p">,</span> <span class="n">u_vec</span><span class="p">,</span> <span class="n">v_vec</span><span class="p">)</span>
    <span class="n">cell_coords_flat</span> <span class="o">=</span> <span class="n">cell_coords</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">transformed_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">transform_coords</span><span class="p">(</span><span class="n">transformer</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span> <span class="k">for</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">cell_coords_flat</span><span class="p">])</span>
    <span class="n">transformed_coords</span> <span class="o">=</span> <span class="n">transformed_coords</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">grid_size</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>

    <span class="c1"># print(f&quot;Grid shape: {grid.shape}&quot;)</span>

    <span class="c1"># Create the visualization using the general plot_grid function</span>
    <span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">adjusted_meshsize</span><span class="p">,</span> <span class="n">u_vec</span><span class="p">,</span> <span class="n">v_vec</span><span class="p">,</span> <span class="n">transformer</span><span class="p">,</span>
              <span class="n">rectangle_vertices</span><span class="p">,</span> <span class="s1">&#39;land_cover&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="n">buf</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="n">edge</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="n">basemap</span><span class="p">,</span> <span class="n">land_cover_classes</span><span class="o">=</span><span class="n">land_cover_classes</span><span class="p">)</span>

    <span class="c1"># Display information about the land cover classes present in the grid</span>
    <span class="n">unique_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
    <span class="n">unique_classes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">land_cover_classes</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">unique_indices</span><span class="p">]</span>
    <span class="c1"># print(f&quot;Unique classes in the grid: {unique_classes}&quot;)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_building_height_grid_on_map</span><span class="p">(</span><span class="n">building_height_grid</span><span class="p">,</span> <span class="n">filtered_buildings</span><span class="p">,</span> <span class="n">rectangle_vertices</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="s1">&#39;CartoDB light&#39;</span><span class="p">):</span>
    <span class="c1"># Calculate grid and normalize vectors</span>
    <span class="n">geod</span> <span class="o">=</span> <span class="n">initialize_geod</span><span class="p">()</span>
    <span class="n">vertex_0</span><span class="p">,</span> <span class="n">vertex_1</span><span class="p">,</span> <span class="n">vertex_3</span> <span class="o">=</span> <span class="n">rectangle_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rectangle_vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rectangle_vertices</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">dist_side_1</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="n">geod</span><span class="p">,</span> <span class="n">vertex_0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertex_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertex_1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertex_1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">dist_side_2</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="n">geod</span><span class="p">,</span> <span class="n">vertex_0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertex_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertex_3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertex_3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">side_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_0</span><span class="p">)</span>
    <span class="n">side_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_0</span><span class="p">)</span>

    <span class="n">u_vec</span> <span class="o">=</span> <span class="n">normalize_to_one_meter</span><span class="p">(</span><span class="n">side_1</span><span class="p">,</span> <span class="n">dist_side_1</span><span class="p">)</span>
    <span class="n">v_vec</span> <span class="o">=</span> <span class="n">normalize_to_one_meter</span><span class="p">(</span><span class="n">side_2</span><span class="p">,</span> <span class="n">dist_side_2</span><span class="p">)</span>

    <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rectangle_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">adjusted_meshsize</span> <span class="o">=</span> <span class="n">calculate_grid_size</span><span class="p">(</span><span class="n">side_1</span><span class="p">,</span> <span class="n">side_2</span><span class="p">,</span> <span class="n">u_vec</span><span class="p">,</span> <span class="n">v_vec</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">)</span>

    <span class="c1"># Setup transformer and plotting extent</span>
    <span class="n">transformer</span> <span class="o">=</span> <span class="n">setup_transformer</span><span class="p">(</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">3857</span><span class="p">))</span>

    <span class="c1"># Plot the results</span>
    <span class="n">plot_grid</span><span class="p">(</span><span class="n">building_height_grid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">adjusted_meshsize</span><span class="p">,</span> <span class="n">u_vec</span><span class="p">,</span> <span class="n">v_vec</span><span class="p">,</span> <span class="n">transformer</span><span class="p">,</span>
              <span class="n">rectangle_vertices</span><span class="p">,</span> <span class="s1">&#39;building_height&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="n">buf</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="n">edge</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="n">basemap</span><span class="p">,</span> <span class="n">buildings</span><span class="o">=</span><span class="n">filtered_buildings</span><span class="p">)</span>
    
<span class="k">def</span><span class="w"> </span><span class="nf">visualize_numerical_grid_on_map</span><span class="p">(</span><span class="n">canopy_height_grid</span><span class="p">,</span> <span class="n">rectangle_vertices</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="s1">&#39;CartoDB light&#39;</span><span class="p">):</span>
    <span class="c1"># Calculate grid and normalize vectors</span>
    <span class="n">geod</span> <span class="o">=</span> <span class="n">initialize_geod</span><span class="p">()</span>
    <span class="n">vertex_0</span><span class="p">,</span> <span class="n">vertex_1</span><span class="p">,</span> <span class="n">vertex_3</span> <span class="o">=</span> <span class="n">rectangle_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rectangle_vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rectangle_vertices</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">dist_side_1</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="n">geod</span><span class="p">,</span> <span class="n">vertex_0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertex_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertex_1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertex_1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">dist_side_2</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="n">geod</span><span class="p">,</span> <span class="n">vertex_0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertex_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertex_3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertex_3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">side_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_0</span><span class="p">)</span>
    <span class="n">side_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_0</span><span class="p">)</span>

    <span class="n">u_vec</span> <span class="o">=</span> <span class="n">normalize_to_one_meter</span><span class="p">(</span><span class="n">side_1</span><span class="p">,</span> <span class="n">dist_side_1</span><span class="p">)</span>
    <span class="n">v_vec</span> <span class="o">=</span> <span class="n">normalize_to_one_meter</span><span class="p">(</span><span class="n">side_2</span><span class="p">,</span> <span class="n">dist_side_2</span><span class="p">)</span>

    <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rectangle_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">adjusted_meshsize</span> <span class="o">=</span> <span class="n">calculate_grid_size</span><span class="p">(</span><span class="n">side_1</span><span class="p">,</span> <span class="n">side_2</span><span class="p">,</span> <span class="n">u_vec</span><span class="p">,</span> <span class="n">v_vec</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">)</span> 

    <span class="c1"># Setup transformer and plotting extent</span>
    <span class="n">transformer</span> <span class="o">=</span> <span class="n">setup_transformer</span><span class="p">(</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">3857</span><span class="p">))</span>

    <span class="c1"># Plot the results</span>
    <span class="n">plot_grid</span><span class="p">(</span><span class="n">canopy_height_grid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">adjusted_meshsize</span><span class="p">,</span> <span class="n">u_vec</span><span class="p">,</span> <span class="n">v_vec</span><span class="p">,</span> <span class="n">transformer</span><span class="p">,</span>
              <span class="n">rectangle_vertices</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">buf</span><span class="o">=</span><span class="n">buf</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="n">edge</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="n">basemap</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_land_cover_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">mesh_size</span><span class="p">,</span> <span class="n">color_map</span><span class="p">,</span> <span class="n">land_cover_classes</span><span class="p">):</span>
    <span class="n">all_classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">land_cover_classes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">unique_classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">all_classes</span><span class="p">))</span>  <span class="c1"># Preserve order and remove duplicates</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_map</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">unique_classes</span><span class="p">]</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_classes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>

    <span class="n">class_to_num</span> <span class="o">=</span> <span class="p">{</span><span class="bp">cls</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_classes</span><span class="p">)}</span>
    <span class="n">numeric_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">class_to_num</span><span class="o">.</span><span class="n">get</span><span class="p">)(</span><span class="n">grid</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">numeric_grid</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">bounds</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">unique_classes</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Land Use/Land Cover Grid (Mesh Size: </span><span class="si">{</span><span class="n">mesh_size</span><span class="si">}</span><span class="s1">m)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Grid Cells (X)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Grid Cells (Y)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_numerical_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">mesh_size</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> (Mesh Size: </span><span class="si">{</span><span class="n">mesh_size</span><span class="si">}</span><span class="s1">m)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Grid Cells (X)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Grid Cells (Y)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">convert_coordinates</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">coords</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculate_centroid</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
    <span class="n">lat_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">)</span>
    <span class="n">lon_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">lat_sum</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">),</span> <span class="n">lon_sum</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculate_center</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
            <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
            <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_circle_polygon</span><span class="p">(</span><span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">,</span> <span class="n">radius_meters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a circular polygon with given center and radius&quot;&quot;&quot;</span>
    <span class="c1"># Convert radius from meters to degrees (approximate)</span>
    <span class="n">radius_deg</span> <span class="o">=</span> <span class="n">radius_meters</span> <span class="o">/</span> <span class="mi">111000</span>  <span class="c1"># 1 degree  111km at equator</span>
    
    <span class="c1"># Create circle points</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">361</span><span class="p">):</span>  <span class="c1"># 0 to 360 degrees</span>
        <span class="n">rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">center_lat</span> <span class="o">+</span> <span class="p">(</span><span class="n">radius_deg</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rad</span><span class="p">))</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">center_lon</span> <span class="o">+</span> <span class="p">(</span><span class="n">radius_deg</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">center_lat</span><span class="p">)))</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_landcover_grid_on_basemap</span><span class="p">(</span><span class="n">landcover_grid</span><span class="p">,</span> <span class="n">rectangle_vertices</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;Standard&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> 
                                     <span class="n">basemap</span><span class="o">=</span><span class="s1">&#39;CartoDB light&#39;</span><span class="p">,</span> <span class="n">show_edge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edge_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualizes a land cover grid GeoDataFrame using predefined color schemes.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        gdf: GeoDataFrame containing grid cells with &#39;geometry&#39; and &#39;value&#39; columns</span>
<span class="sd">        source: Source of land cover classification (e.g., &#39;Standard&#39;, &#39;Urbanwatch&#39;, etc.)</span>
<span class="sd">        title: Title for the plot (default: None)</span>
<span class="sd">        alpha: Transparency of the grid overlay (default: 0.6)</span>
<span class="sd">        figsize: Figure size in inches (default: (12, 8))</span>
<span class="sd">        basemap: Basemap style (default: &#39;CartoDB light&#39;)</span>
<span class="sd">        show_edge: Whether to show cell edges (default: True)</span>
<span class="sd">        edge_color: Color of cell edges (default: &#39;black&#39;)</span>
<span class="sd">        edge_width: Width of cell edges (default: 0.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get land cover classes and colors</span>
    <span class="n">land_cover_classes</span> <span class="o">=</span> <span class="n">get_land_cover_classes</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

    <span class="n">gdf</span> <span class="o">=</span> <span class="n">grid_to_geodataframe</span><span class="p">(</span><span class="n">landcover_grid</span><span class="p">,</span> <span class="n">rectangle_vertices</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">)</span>
    
    <span class="c1"># Convert RGB tuples to normalized RGB values</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">r</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="n">g</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">land_cover_classes</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    
    <span class="c1"># Create custom colormap</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
    
    <span class="c1"># Create bounds for discrete colorbar</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
    
    <span class="c1"># Convert to Web Mercator</span>
    <span class="n">gdf_web</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
    
    <span class="c1"># Create figure and axis</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    
    <span class="c1"># Plot the GeoDataFrame</span>
    <span class="n">gdf_web</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span>
                 <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                 <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                 <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                 <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span>
                     <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Land Cover Class&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;ticks&#39;</span><span class="p">:</span> <span class="n">bounds</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
                     <span class="s1">&#39;boundaries&#39;</span><span class="p">:</span> <span class="n">bounds</span><span class="p">,</span>
                     <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">land_cover_classes</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
                 <span class="p">},</span>
                 <span class="n">edgecolor</span><span class="o">=</span><span class="n">edge_color</span> <span class="k">if</span> <span class="n">show_edge</span> <span class="k">else</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
                 <span class="n">linewidth</span><span class="o">=</span><span class="n">edge_width</span> <span class="k">if</span> <span class="n">show_edge</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># Add basemap</span>
    <span class="n">basemaps</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CartoDB dark&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">DarkMatter</span><span class="p">,</span>
        <span class="s1">&#39;CartoDB light&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Positron</span><span class="p">,</span>
        <span class="s1">&#39;CartoDB voyager&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Voyager</span><span class="p">,</span>
        <span class="s1">&#39;CartoDB light no labels&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">PositronNoLabels</span><span class="p">,</span>
        <span class="s1">&#39;CartoDB dark no labels&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">DarkMatterNoLabels</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">basemaps</span><span class="p">[</span><span class="n">basemap</span><span class="p">])</span>
    
    <span class="c1"># Set title and remove axes</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_numerical_grid_on_basemap</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">rectangle_vertices</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">basemap</span><span class="o">=</span><span class="s1">&#39;CartoDB light&#39;</span><span class="p">,</span>
                                          <span class="n">show_edge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edge_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualizes a numerical grid GeoDataFrame (e.g., heights) on a basemap.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        gdf: GeoDataFrame containing grid cells with &#39;geometry&#39; and &#39;value&#39; columns</span>
<span class="sd">        title: Title for the plot (default: None)</span>
<span class="sd">        cmap: Colormap to use (default: &#39;viridis&#39;)</span>
<span class="sd">        vmin: Minimum value for colormap scaling (default: None)</span>
<span class="sd">        vmax: Maximum value for colormap scaling (default: None)</span>
<span class="sd">        alpha: Transparency of the grid overlay (default: 0.6)</span>
<span class="sd">        figsize: Figure size in inches (default: (12, 8))</span>
<span class="sd">        basemap: Basemap style (default: &#39;CartoDB light&#39;)</span>
<span class="sd">        show_edge: Whether to show cell edges (default: True)</span>
<span class="sd">        edge_color: Color of cell edges (default: &#39;black&#39;)</span>
<span class="sd">        edge_width: Width of cell edges (default: 0.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gdf</span> <span class="o">=</span> <span class="n">grid_to_geodataframe</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">rectangle_vertices</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">)</span>

    <span class="c1"># Convert to Web Mercator</span>
    <span class="n">gdf_web</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
    
    <span class="c1"># Create figure and axis</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    
    <span class="c1"># Plot the GeoDataFrame</span>
    <span class="n">gdf_web</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span>
                 <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                 <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                 <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
                 <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                 <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">value_name</span><span class="p">},</span>
                 <span class="n">edgecolor</span><span class="o">=</span><span class="n">edge_color</span> <span class="k">if</span> <span class="n">show_edge</span> <span class="k">else</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
                 <span class="n">linewidth</span><span class="o">=</span><span class="n">edge_width</span> <span class="k">if</span> <span class="n">show_edge</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># Add basemap</span>
    <span class="n">basemaps</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CartoDB dark&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">DarkMatter</span><span class="p">,</span>
        <span class="s1">&#39;CartoDB light&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Positron</span><span class="p">,</span>
        <span class="s1">&#39;CartoDB voyager&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Voyager</span><span class="p">,</span>
        <span class="s1">&#39;CartoDB light no labels&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">PositronNoLabels</span><span class="p">,</span>
        <span class="s1">&#39;CartoDB dark no labels&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">DarkMatterNoLabels</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">basemaps</span><span class="p">[</span><span class="n">basemap</span><span class="p">])</span>
    
    <span class="c1"># Set title and remove axes</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_numerical_gdf_on_basemap</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">basemap</span><span class="o">=</span><span class="s1">&#39;CartoDB light&#39;</span><span class="p">,</span>
                            <span class="n">show_edge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edge_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualizes a GeoDataFrame with numerical values on a basemap.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        gdf: GeoDataFrame containing grid cells with &#39;geometry&#39; and &#39;value&#39; columns</span>
<span class="sd">        value_name: Name of the value column and legend label (default: &quot;value&quot;)</span>
<span class="sd">        cmap: Colormap to use (default: &#39;viridis&#39;)</span>
<span class="sd">        vmin: Minimum value for colormap scaling (default: None)</span>
<span class="sd">        vmax: Maximum value for colormap scaling (default: None)</span>
<span class="sd">        alpha: Transparency of the grid overlay (default: 0.6)</span>
<span class="sd">        figsize: Figure size in inches (default: (12, 8))</span>
<span class="sd">        basemap: Basemap style (default: &#39;CartoDB light&#39;)</span>
<span class="sd">        show_edge: Whether to show cell edges (default: False)</span>
<span class="sd">        edge_color: Color of cell edges (default: &#39;black&#39;)</span>
<span class="sd">        edge_width: Width of cell edges (default: 0.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert to Web Mercator if not already in that CRS</span>
    <span class="k">if</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span> <span class="o">!=</span> <span class="s1">&#39;EPSG:3857&#39;</span><span class="p">:</span>
        <span class="n">gdf_web</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gdf_web</span> <span class="o">=</span> <span class="n">gdf</span>
    
    <span class="c1"># Create figure and axis</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    
    <span class="c1"># Plot the GeoDataFrame</span>
    <span class="n">gdf_web</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">value_name</span><span class="p">,</span>
                 <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                 <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                 <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
                 <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                 <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">value_name</span><span class="p">},</span>
                 <span class="n">edgecolor</span><span class="o">=</span><span class="n">edge_color</span> <span class="k">if</span> <span class="n">show_edge</span> <span class="k">else</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
                 <span class="n">linewidth</span><span class="o">=</span><span class="n">edge_width</span> <span class="k">if</span> <span class="n">show_edge</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># Add basemap</span>
    <span class="n">basemaps</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CartoDB dark&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">DarkMatter</span><span class="p">,</span>
        <span class="s1">&#39;CartoDB light&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Positron</span><span class="p">,</span>
        <span class="s1">&#39;CartoDB voyager&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Voyager</span><span class="p">,</span>
        <span class="s1">&#39;CartoDB light no labels&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">PositronNoLabels</span><span class="p">,</span>
        <span class="s1">&#39;CartoDB dark no labels&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">DarkMatterNoLabels</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">basemaps</span><span class="p">[</span><span class="n">basemap</span><span class="p">])</span>
    
    <span class="c1"># Set title and remove axes</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_point_gdf_on_basemap</span><span class="p">(</span><span class="n">point_gdf</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualizes a point GeoDataFrame on a basemap with colors based on values.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        point_gdf: GeoDataFrame with point geometries and values</span>
<span class="sd">        value_name: Name of the column containing values to visualize (default: &#39;value&#39;)</span>
<span class="sd">        **kwargs: Optional visualization parameters including:</span>
<span class="sd">            - figsize: Tuple for figure size (default: (12, 8))</span>
<span class="sd">            - colormap: Matplotlib colormap name (default: &#39;viridis&#39;)</span>
<span class="sd">            - markersize: Size of points (default: 20)</span>
<span class="sd">            - alpha: Transparency of points (default: 0.7)</span>
<span class="sd">            - vmin: Minimum value for colormap scaling (default: None)</span>
<span class="sd">            - vmax: Maximum value for colormap scaling (default: None)</span>
<span class="sd">            - title: Plot title (default: None)</span>
<span class="sd">            - basemap_style: Contextily basemap style (default: CartoDB.Positron)</span>
<span class="sd">            - zoom: Basemap zoom level (default: 15)</span>
<span class="sd">            </span>
<span class="sd">    Returns:</span>
<span class="sd">        matplotlib figure and axis objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">contextily</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ctx</span>
    
    <span class="c1"># Set default parameters</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
        <span class="s1">&#39;colormap&#39;</span><span class="p">:</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
        <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
        <span class="s1">&#39;vmin&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;basemap_style&#39;</span><span class="p">:</span> <span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Positron</span><span class="p">,</span>
        <span class="s1">&#39;zoom&#39;</span><span class="p">:</span> <span class="mi">15</span>
    <span class="p">}</span>
    
    <span class="c1"># Update defaults with provided kwargs</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">defaults</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">}</span>
    
    <span class="c1"># Create figure and axis</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
    
    <span class="c1"># Convert to Web Mercator for basemap compatibility</span>
    <span class="n">point_gdf_web</span> <span class="o">=</span> <span class="n">point_gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
    
    <span class="c1"># Plot points</span>
    <span class="n">scatter</span> <span class="o">=</span> <span class="n">point_gdf_web</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">column</span><span class="o">=</span><span class="n">value_name</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">],</span>
        <span class="n">markersize</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;markersize&#39;</span><span class="p">],</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">],</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">],</span>
        <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">value_name</span><span class="p">,</span>
            <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
            <span class="s1">&#39;shrink&#39;</span><span class="p">:</span> <span class="mf">0.8</span>
        <span class="p">}</span>
    <span class="p">)</span>
    
    <span class="c1"># Add basemap</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span>
        <span class="n">ax</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;basemap_style&#39;</span><span class="p">],</span>
        <span class="n">zoom</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;zoom&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    
    <span class="c1"># Set title if provided</span>
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>
    
    <span class="c1"># Remove axes</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    
    <span class="c1"># Adjust layout to prevent colorbar cutoff</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_multi_view_scene</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">projection_type</span><span class="o">=</span><span class="s2">&quot;perspective&quot;</span><span class="p">,</span> <span class="n">distance_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates multiple rendered views of 3D city meshes from different camera angles.</span>
<span class="sd">    </span>
<span class="sd">    This function generates a comprehensive set of views including isometric and</span>
<span class="sd">    orthographic projections of the 3D city model. Each view is rendered as a</span>
<span class="sd">    high-quality image and saved to the specified directory.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    meshes : dict</span>
<span class="sd">        Dictionary mapping mesh names/IDs to trimesh.Trimesh objects.</span>
<span class="sd">        Each mesh represents a different component of the city model.</span>
<span class="sd">        </span>
<span class="sd">    output_directory : str, optional</span>
<span class="sd">        Directory path where rendered images will be saved. Default is &quot;output&quot;.</span>
<span class="sd">        </span>
<span class="sd">    projection_type : str, optional</span>
<span class="sd">        Camera projection type. Options:</span>
<span class="sd">        - &quot;perspective&quot;: Natural perspective projection (default)</span>
<span class="sd">        - &quot;orthographic&quot;: Technical orthographic projection</span>
<span class="sd">        </span>
<span class="sd">    distance_factor : float, optional</span>
<span class="sd">        Multiplier for camera distance from the scene. Default is 1.0.</span>
<span class="sd">        Higher values move camera further away, lower values bring it closer.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    list of tuple</span>
<span class="sd">        List of (view_name, filename) pairs for each generated image.</span>
<span class="sd">        </span>
<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - Generates 9 different views: 4 isometric + 5 orthographic</span>
<span class="sd">    - Isometric views: front-right, front-left, back-right, back-left</span>
<span class="sd">    - Orthographic views: top, front, back, left, right</span>
<span class="sd">    - Uses PyVista for high-quality rendering with proper lighting</span>
<span class="sd">    - Camera positions are automatically calculated based on scene bounds</span>
<span class="sd">    - Images are saved as PNG files with high DPI</span>
<span class="sd">    </span>
<span class="sd">    Technical Details:</span>
<span class="sd">    ------------------</span>
<span class="sd">    - Scene bounding box is computed from all mesh vertices</span>
<span class="sd">    - Camera distance is scaled based on scene diagonal</span>
<span class="sd">    - Orthographic projection uses parallel scaling for technical drawings</span>
<span class="sd">    - Each view uses optimized lighting for clarity</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">    ---------</span>
<span class="sd">    &gt;&gt;&gt; meshes = {&#39;buildings&#39;: building_mesh, &#39;ground&#39;: ground_mesh}</span>
<span class="sd">    &gt;&gt;&gt; views = create_multi_view_scene(meshes, &quot;renders/&quot;, &quot;orthographic&quot;, 1.5)</span>
<span class="sd">    &gt;&gt;&gt; print(f&quot;Generated {len(views)} views&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute overall bounding box across all meshes</span>
    <span class="n">vertices_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">meshes</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
    <span class="n">all_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">vertices_list</span><span class="p">)</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="n">all_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">all_vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">all_vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span>
        <span class="p">[</span><span class="n">all_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">all_vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">all_vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
    <span class="p">])</span>

    <span class="c1"># Compute the center and diagonal of the bounding box</span>
    <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">diagonal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Adjust distance based on projection type</span>
    <span class="k">if</span> <span class="n">projection_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;orthographic&quot;</span><span class="p">:</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">diagonal</span> <span class="o">*</span> <span class="mi">5</span>  <span class="c1"># Increase distance for orthographic to capture full scene</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">diagonal</span> <span class="o">*</span> <span class="mf">1.8</span> <span class="o">*</span> <span class="n">distance_factor</span>  <span class="c1"># Original distance for perspective</span>

    <span class="c1"># Define the isometric viewing angles</span>
    <span class="n">iso_angles</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;iso_front_right&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span>
        <span class="s1">&#39;iso_front_left&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span>
        <span class="s1">&#39;iso_back_right&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span>
        <span class="s1">&#39;iso_back_left&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1"># Compute camera positions for isometric views</span>
    <span class="n">camera_positions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">iso_angles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
        <span class="n">camera_pos</span> <span class="o">=</span> <span class="n">center</span> <span class="o">+</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">distance</span>
        <span class="n">camera_positions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">camera_pos</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="c1"># Add orthographic views</span>
    <span class="n">ortho_views</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;xy_top&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">center</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">distance</span><span class="p">]),</span> <span class="n">center</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
        <span class="s1">&#39;yz_right&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">center</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">distance</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">center</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
        <span class="s1">&#39;xz_front&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">center</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">center</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
        <span class="s1">&#39;yz_left&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">center</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">distance</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">center</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
        <span class="s1">&#39;xz_back&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">center</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">distance</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">center</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="p">}</span>
    <span class="n">camera_positions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ortho_views</span><span class="p">)</span>

    <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">view_name</span><span class="p">,</span> <span class="n">camera_pos</span> <span class="ow">in</span> <span class="n">camera_positions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Create new plotter for each view</span>
        <span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">off_screen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Set the projection type</span>
        <span class="k">if</span> <span class="n">projection_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;orthographic&quot;</span><span class="p">:</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">enable_parallel_projection</span><span class="p">()</span>
            <span class="c1"># Set parallel scale to ensure the whole scene is visible</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">parallel_scale</span> <span class="o">=</span> <span class="n">diagonal</span> <span class="o">*</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">distance_factor</span>  <span class="c1"># Adjust this factor as needed</span>

        <span class="k">elif</span> <span class="n">projection_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;perspective&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Unknown projection_type &#39;</span><span class="si">{</span><span class="n">projection_type</span><span class="si">}</span><span class="s2">&#39;. Using perspective projection.&quot;</span><span class="p">)</span>

        <span class="c1"># Add each mesh to the scene</span>
        <span class="k">for</span> <span class="n">class_id</span><span class="p">,</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">meshes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">vertices</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span>
            <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="n">face</span><span class="p">]</span> <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">])</span>
            <span class="n">pv_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">visual</span><span class="p">,</span> <span class="s1">&#39;face_colors&#39;</span><span class="p">):</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">visual</span><span class="o">.</span><span class="n">face_colors</span>
                <span class="k">if</span> <span class="n">colors</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span> <span class="o">/</span> <span class="mf">255.0</span>
                <span class="n">pv_mesh</span><span class="o">.</span><span class="n">cell_data</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span>

            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">pv_mesh</span><span class="p">,</span>
                           <span class="n">rgb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">scalars</span><span class="o">=</span><span class="s1">&#39;colors&#39;</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">visual</span><span class="p">,</span> <span class="s1">&#39;face_colors&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Set camera position for this view</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">camera_position</span> <span class="o">=</span> <span class="n">camera_pos</span>

        <span class="c1"># Save screenshot</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_directory</span><span class="si">}</span><span class="s1">/city_view_</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s1">.png&#39;</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">view_name</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">images</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_voxcity_multi_view</span><span class="p">(</span><span class="n">voxel_array</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates comprehensive 3D visualizations of voxel city data with multiple viewing angles.</span>
<span class="sd">    </span>
<span class="sd">    This is the primary function for generating publication-quality renderings of voxel</span>
<span class="sd">    city models. It converts voxel data to 3D meshes, optionally overlays simulation</span>
<span class="sd">    results, and produces multiple rendered views from different camera positions.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    voxel_array : numpy.ndarray</span>
<span class="sd">        3D array containing voxel class IDs. Shape should be (x, y, z).</span>
<span class="sd">        </span>
<span class="sd">    meshsize : float</span>
<span class="sd">        Physical size of each voxel in meters.</span>
<span class="sd">        </span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Optional visualization parameters:</span>
<span class="sd">        </span>
<span class="sd">        Color and Style:</span>
<span class="sd">        - voxel_color_map (str): Color scheme name, default &#39;default&#39;</span>
<span class="sd">        - output_directory (str): Directory for output files, default &#39;output&#39;</span>
<span class="sd">        - output_file_name (str): Base name for exported files</span>
<span class="sd">        </span>
<span class="sd">        Simulation Overlay:</span>
<span class="sd">        - sim_grid (numpy.ndarray): 2D simulation results to overlay</span>
<span class="sd">        - dem_grid (numpy.ndarray): Digital elevation model for height reference</span>
<span class="sd">        - view_point_height (float): Height offset for simulation surface, default 1.5m</span>
<span class="sd">        - colormap (str): Matplotlib colormap for simulation data, default &#39;viridis&#39;</span>
<span class="sd">        - vmin, vmax (float): Color scale limits for simulation data</span>
<span class="sd">        </span>
<span class="sd">        Camera and Rendering:</span>
<span class="sd">        - projection_type (str): &#39;perspective&#39; or &#39;orthographic&#39;, default &#39;perspective&#39;</span>
<span class="sd">        - distance_factor (float): Camera distance multiplier, default 1.0</span>
<span class="sd">        - window_width, window_height (int): Render resolution, default 1024x768</span>
<span class="sd">        </span>
<span class="sd">        Output Control:</span>
<span class="sd">        - show_views (bool): Whether to display rendered views, default True</span>
<span class="sd">        - save_obj (bool): Whether to export OBJ mesh files, default False</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        Displays rendered views and optionally saves files to disk.</span>
<span class="sd">        </span>
<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - Automatically configures PyVista for headless rendering</span>
<span class="sd">    - Generates meshes for each voxel class with appropriate colors</span>
<span class="sd">    - Creates colorbar for simulation data if provided</span>
<span class="sd">    - Produces 9 different camera views (4 isometric + 5 orthographic)</span>
<span class="sd">    - Exports mesh files in OBJ format if requested</span>
<span class="sd">    </span>
<span class="sd">    Technical Requirements:</span>
<span class="sd">    -----------------------</span>
<span class="sd">    - Requires Xvfb for headless rendering on Linux systems</span>
<span class="sd">    - Uses PyVista for high-quality 3D rendering</span>
<span class="sd">    - Simulation data is interpolated onto elevated surface mesh</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">    ---------</span>
<span class="sd">    &gt;&gt;&gt; # Basic visualization</span>
<span class="sd">    &gt;&gt;&gt; visualize_voxcity_multi_view(voxel_array, meshsize=2.0)</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # With simulation results overlay</span>
<span class="sd">    &gt;&gt;&gt; visualize_voxcity_multi_view(</span>
<span class="sd">    ...     voxel_array, 2.0,</span>
<span class="sd">    ...     sim_grid=temperature_data,</span>
<span class="sd">    ...     dem_grid=elevation_data,</span>
<span class="sd">    ...     colormap=&#39;plasma&#39;,</span>
<span class="sd">    ...     output_file_name=&#39;temperature_analysis&#39;</span>
<span class="sd">    ... )</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # High-resolution orthographic technical drawings</span>
<span class="sd">    &gt;&gt;&gt; visualize_voxcity_multi_view(</span>
<span class="sd">    ...     voxel_array, 2.0,</span>
<span class="sd">    ...     projection_type=&#39;orthographic&#39;,</span>
<span class="sd">    ...     window_width=2048,</span>
<span class="sd">    ...     window_height=1536,</span>
<span class="sd">    ...     save_obj=True</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set up headless rendering environment for PyVista</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;Xvfb :99 -screen 0 1024x768x24 &gt; /dev/null 2&gt;&amp;1 &amp;&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DISPLAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;:99&#39;</span>

    <span class="c1"># Configure PyVista settings for high-quality rendering</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">set_plot_theme</span><span class="p">(</span><span class="s1">&#39;document&#39;</span><span class="p">)</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">]</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">jupyter_backend</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>
    
    <span class="c1"># Parse visualization parameters from kwargs</span>
    <span class="n">voxel_color_map</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;voxel_color_map&quot;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="n">vox_dict</span> <span class="o">=</span> <span class="n">get_voxel_color_map</span><span class="p">(</span><span class="n">voxel_color_map</span><span class="p">)</span>
    <span class="n">output_directory</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output_directory&quot;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
    <span class="n">base_filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output_file_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">sim_grid</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sim_grid&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">dem_grid_ori</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dem_grid&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    
    <span class="c1"># Normalize DEM grid to start from zero elevation</span>
    <span class="k">if</span> <span class="n">dem_grid_ori</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dem_grid</span> <span class="o">=</span> <span class="n">dem_grid_ori</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dem_grid_ori</span><span class="p">)</span>
        
    <span class="c1"># Simulation overlay parameters</span>
    <span class="n">z_offset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;view_point_height&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
    <span class="n">cmap_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;colormap&quot;</span><span class="p">,</span> <span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">sim_grid</span><span class="p">)</span> <span class="k">if</span> <span class="n">sim_grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">sim_grid</span><span class="p">)</span> <span class="k">if</span> <span class="n">sim_grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
    
    <span class="c1"># Camera and rendering parameters</span>
    <span class="n">projection_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projection_type&quot;</span><span class="p">,</span> <span class="s2">&quot;perspective&quot;</span><span class="p">)</span>
    <span class="n">distance_factor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;distance_factor&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    
    <span class="c1"># Output control parameters</span>
    <span class="n">save_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;save_obj&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">show_views</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;show_views&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Create 3D meshes from voxel data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating voxel meshes...&quot;</span><span class="p">)</span>
    <span class="n">meshes</span> <span class="o">=</span> <span class="n">create_city_meshes</span><span class="p">(</span><span class="n">voxel_array</span><span class="p">,</span> <span class="n">vox_dict</span><span class="p">,</span> <span class="n">meshsize</span><span class="o">=</span><span class="n">meshsize</span><span class="p">)</span>

    <span class="c1"># Add simulation results as elevated surface mesh if provided</span>
    <span class="k">if</span> <span class="n">sim_grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dem_grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating sim_grid surface mesh...&quot;</span><span class="p">)</span>
        <span class="n">sim_mesh</span> <span class="o">=</span> <span class="n">create_sim_surface_mesh</span><span class="p">(</span>
            <span class="n">sim_grid</span><span class="p">,</span> <span class="n">dem_grid</span><span class="p">,</span>
            <span class="n">meshsize</span><span class="o">=</span><span class="n">meshsize</span><span class="p">,</span>
            <span class="n">z_offset</span><span class="o">=</span><span class="n">z_offset</span><span class="p">,</span>
            <span class="n">cmap_name</span><span class="o">=</span><span class="n">cmap_name</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">sim_mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">meshes</span><span class="p">[</span><span class="s2">&quot;sim_surface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_mesh</span>
            
        <span class="c1"># Create and display colorbar for simulation data</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">scalar_map</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_name</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scalar_map</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Export mesh files if requested</span>
    <span class="k">if</span> <span class="n">base_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exporting files to &#39;</span><span class="si">{</span><span class="n">base_filename</span><span class="si">}</span><span class="s2">.*&#39; ...&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">export_meshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">output_directory</span><span class="p">,</span> <span class="n">base_filename</span><span class="p">)</span>

    <span class="c1"># Generate and display multiple camera views</span>
    <span class="k">if</span> <span class="n">show_views</span><span class="p">:</span>  
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating multiple views...&quot;</span><span class="p">)</span>        
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">image_files</span> <span class="o">=</span> <span class="n">create_multi_view_scene</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">projection_type</span><span class="o">=</span><span class="n">projection_type</span><span class="p">,</span> <span class="n">distance_factor</span><span class="o">=</span><span class="n">distance_factor</span><span class="p">)</span>

        <span class="c1"># Display each rendered view</span>
        <span class="k">for</span> <span class="n">view_name</span><span class="p">,</span> <span class="n">img_file</span> <span class="ow">in</span> <span class="n">image_files</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_file</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">view_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="c1"># Export OBJ mesh files if requested</span>
    <span class="k">if</span> <span class="n">save_obj</span><span class="p">:</span>
        <span class="n">output_directory</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output_directory&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
        <span class="n">output_file_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output_file_name&#39;</span><span class="p">,</span> <span class="s1">&#39;voxcity_mesh&#39;</span><span class="p">)</span>
        <span class="n">obj_path</span><span class="p">,</span> <span class="n">mtl_path</span> <span class="o">=</span> <span class="n">save_obj_from_colored_mesh</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">output_directory</span><span class="p">,</span> <span class="n">output_file_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved mesh files to:</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="n">obj_path</span><span class="si">}</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="n">mtl_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_voxcity_multi_view_with_multiple_sim_grids</span><span class="p">(</span><span class="n">voxel_array</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">,</span> <span class="n">sim_configs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create multiple views of the voxel city data with multiple simulation grids.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        voxel_array: 3D numpy array containing voxel data</span>
<span class="sd">        meshsize: Size of each voxel/cell</span>
<span class="sd">        sim_configs: List of dictionaries, each containing configuration for a simulation grid:</span>
<span class="sd">            {</span>
<span class="sd">                &#39;sim_grid&#39;: 2D numpy array of simulation values,</span>
<span class="sd">                &#39;z_offset&#39;: height offset in meters (default: 1.5),</span>
<span class="sd">                &#39;cmap_name&#39;: colormap name (default: &#39;viridis&#39;),</span>
<span class="sd">                &#39;vmin&#39;: minimum value for colormap (optional),</span>
<span class="sd">                &#39;vmax&#39;: maximum value for colormap (optional),</span>
<span class="sd">                &#39;label&#39;: label for the colorbar (optional)</span>
<span class="sd">            }</span>
<span class="sd">        **kwargs: Additional arguments including:</span>
<span class="sd">            - vox_dict: Dictionary mapping voxel values to colors</span>
<span class="sd">            - output_directory: Directory to save output images</span>
<span class="sd">            - output_file_name: Base filename for exports</span>
<span class="sd">            - dem_grid: DEM grid for height information</span>
<span class="sd">            - projection_type: &#39;perspective&#39; or &#39;orthographic&#39;</span>
<span class="sd">            - distance_factor: Factor to adjust camera distance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;Xvfb :99 -screen 0 1024x768x24 &gt; /dev/null 2&gt;&amp;1 &amp;&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DISPLAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;:99&#39;</span>

    <span class="c1"># Configure PyVista settings</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">set_plot_theme</span><span class="p">(</span><span class="s1">&#39;document&#39;</span><span class="p">)</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
    <span class="n">window_width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;window_width&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
    <span class="n">window_height</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;window_height&quot;</span><span class="p">,</span> <span class="mi">768</span><span class="p">)</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">window_width</span><span class="p">,</span> <span class="n">window_height</span><span class="p">]</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">jupyter_backend</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>

    <span class="c1"># Parse general kwargs</span>
    <span class="n">voxel_color_map</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;voxel_color_map&quot;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="n">vox_dict</span> <span class="o">=</span> <span class="n">get_voxel_color_map</span><span class="p">(</span><span class="n">voxel_color_map</span><span class="p">)</span>
    <span class="n">output_directory</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output_directory&quot;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
    <span class="n">base_filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output_file_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">dem_grid_ori</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dem_grid&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">projection_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projection_type&quot;</span><span class="p">,</span> <span class="s2">&quot;perspective&quot;</span><span class="p">)</span>
    <span class="n">distance_factor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;distance_factor&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">show_views</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;show_views&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">save_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;save_obj&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dem_grid_ori</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dem_grid</span> <span class="o">=</span> <span class="n">dem_grid_ori</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dem_grid_ori</span><span class="p">)</span>
    
    <span class="c1"># Create meshes</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating voxel meshes...&quot;</span><span class="p">)</span>
    <span class="n">meshes</span> <span class="o">=</span> <span class="n">create_city_meshes</span><span class="p">(</span><span class="n">voxel_array</span><span class="p">,</span> <span class="n">vox_dict</span><span class="p">,</span> <span class="n">meshsize</span><span class="o">=</span><span class="n">meshsize</span><span class="p">)</span>

    <span class="c1"># Process each simulation grid</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sim_configs</span><span class="p">):</span>
        <span class="n">sim_grid</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;sim_grid&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sim_grid</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dem_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">z_offset</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z_offset&#39;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">cmap_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmap_name&#39;</span><span class="p">,</span> <span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vmin&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">sim_grid</span><span class="p">))</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">sim_grid</span><span class="p">))</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Simulation </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating sim_grid surface mesh for </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">sim_mesh</span> <span class="o">=</span> <span class="n">create_sim_surface_mesh</span><span class="p">(</span>
            <span class="n">sim_grid</span><span class="p">,</span> <span class="n">dem_grid</span><span class="p">,</span>
            <span class="n">meshsize</span><span class="o">=</span><span class="n">meshsize</span><span class="p">,</span>
            <span class="n">z_offset</span><span class="o">=</span><span class="n">z_offset</span><span class="p">,</span>
            <span class="n">cmap_name</span><span class="o">=</span><span class="n">cmap_name</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">sim_mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">meshes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;sim_surface_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_mesh</span>
            
            <span class="c1"># Create colorbar for this simulation</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
            <span class="n">scalar_map</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_name</span><span class="p">)</span>
            
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scalar_map</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Export if filename provided</span>
    <span class="k">if</span> <span class="n">base_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exporting files to &#39;</span><span class="si">{</span><span class="n">base_filename</span><span class="si">}</span><span class="s2">.*&#39; ...&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">export_meshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">output_directory</span><span class="p">,</span> <span class="n">base_filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_views</span><span class="p">:</span>
        <span class="c1"># Create and save multiple views</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating multiple views...&quot;</span><span class="p">)</span>        
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">image_files</span> <span class="o">=</span> <span class="n">create_multi_view_scene</span><span class="p">(</span>
            <span class="n">meshes</span><span class="p">,</span> 
            <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span>
            <span class="n">projection_type</span><span class="o">=</span><span class="n">projection_type</span><span class="p">,</span>
            <span class="n">distance_factor</span><span class="o">=</span><span class="n">distance_factor</span>
        <span class="p">)</span>

        <span class="c1"># Display each view separately</span>
        <span class="k">for</span> <span class="n">view_name</span><span class="p">,</span> <span class="n">img_file</span> <span class="ow">in</span> <span class="n">image_files</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_file</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">view_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># After creating the meshes and before visualization</span>
    <span class="k">if</span> <span class="n">save_obj</span><span class="p">:</span>
        <span class="n">output_directory</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output_directory&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
        <span class="n">output_file_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output_file_name&#39;</span><span class="p">,</span> <span class="s1">&#39;voxcity_mesh&#39;</span><span class="p">)</span>
        <span class="n">obj_path</span><span class="p">,</span> <span class="n">mtl_path</span> <span class="o">=</span> <span class="n">save_obj_from_colored_mesh</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">output_directory</span><span class="p">,</span> <span class="n">output_file_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved mesh files to:</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="n">obj_path</span><span class="si">}</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="n">mtl_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_voxcity_with_sim_meshes</span><span class="p">(</span><span class="n">voxel_array</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">,</span> <span class="n">custom_meshes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates 3D visualizations of voxel city data with custom simulation mesh overlays.</span>
<span class="sd">    </span>
<span class="sd">    This advanced visualization function allows replacement of specific voxel classes</span>
<span class="sd">    with custom simulation result meshes. It&#39;s particularly useful for overlaying</span>
<span class="sd">    detailed simulation results (like computational fluid dynamics, thermal analysis,</span>
<span class="sd">    or environmental factors) onto specific building or infrastructure components.</span>
<span class="sd">    </span>
<span class="sd">    The function supports simulation meshes with metadata containing numerical values</span>
<span class="sd">    that can be visualized using color mapping, making it ideal for displaying</span>
<span class="sd">    spatially-varying simulation results on building surfaces or other urban elements.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    voxel_array : np.ndarray</span>
<span class="sd">        3D array of voxel values representing the base city model.</span>
<span class="sd">        Shape should be (x, y, z) where each element is a voxel class ID.</span>
<span class="sd">        </span>
<span class="sd">    meshsize : float</span>
<span class="sd">        Size of each voxel in meters, used for coordinate scaling.</span>
<span class="sd">        </span>
<span class="sd">    custom_meshes : dict, optional</span>
<span class="sd">        Dictionary mapping voxel class IDs to custom trimesh.Trimesh objects.</span>
<span class="sd">        Example: {-3: building_simulation_mesh, -2: vegetation_mesh}</span>
<span class="sd">        These meshes will replace the standard voxel representation for visualization.</span>
<span class="sd">        Default is None.</span>
<span class="sd">        </span>
<span class="sd">    **kwargs:</span>
<span class="sd">        Extensive configuration options organized by category:</span>
<span class="sd">        </span>
<span class="sd">        Base Visualization:</span>
<span class="sd">        - vox_dict (dict): Dictionary mapping voxel class IDs to colors</span>
<span class="sd">        - output_directory (str): Directory for saving output files</span>
<span class="sd">        - output_file_name (str): Base filename for exported meshes</span>
<span class="sd">        </span>
<span class="sd">        Simulation Result Display:</span>
<span class="sd">        - value_name (str): Name of metadata field containing simulation values</span>
<span class="sd">        - colormap (str): Matplotlib colormap name for simulation results</span>
<span class="sd">        - vmin, vmax (float): Color scale limits for simulation data</span>
<span class="sd">        - colorbar_title (str): Title for the simulation result colorbar</span>
<span class="sd">        - nan_color (str/tuple): Color for NaN/invalid simulation values, default &#39;gray&#39;</span>
<span class="sd">        </span>
<span class="sd">        Ground Surface Overlay:</span>
<span class="sd">        - sim_grid (np.ndarray): 2D array with ground-level simulation values</span>
<span class="sd">        - dem_grid (np.ndarray): Digital elevation model for terrain height</span>
<span class="sd">        - view_point_height (float): Height offset for ground simulation surface</span>
<span class="sd">        </span>
<span class="sd">        Camera and Rendering:</span>
<span class="sd">        - projection_type (str): &#39;perspective&#39; or &#39;orthographic&#39;, default &#39;perspective&#39;</span>
<span class="sd">        - distance_factor (float): Camera distance multiplier, default 1.0</span>
<span class="sd">        - window_width, window_height (int): Render resolution</span>
<span class="sd">        </span>
<span class="sd">        Output Control:</span>
<span class="sd">        - show_views (bool): Whether to display rendered views, default True</span>
<span class="sd">        - save_obj (bool): Whether to export OBJ mesh files, default False</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    list</span>
<span class="sd">        List of (view_name, image_file_path) tuples for generated views.</span>
<span class="sd">        Only returned if show_views=True.</span>
<span class="sd">        </span>
<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    Simulation Mesh Requirements:</span>
<span class="sd">    - Custom meshes should have simulation values stored in mesh.metadata[value_name]</span>
<span class="sd">    - Values can include NaN for areas without valid simulation data</span>
<span class="sd">    - Mesh geometry should align with the voxel grid coordinate system</span>
<span class="sd">    </span>
<span class="sd">    Color Mapping:</span>
<span class="sd">    - Simulation values are mapped to colors using the specified colormap</span>
<span class="sd">    - NaN values are rendered in the specified nan_color</span>
<span class="sd">    - A colorbar is automatically generated and displayed</span>
<span class="sd">    </span>
<span class="sd">    Technical Implementation:</span>
<span class="sd">    - Uses PyVista for high-quality 3D rendering</span>
<span class="sd">    - Supports both individual mesh coloring and ground surface overlays</span>
<span class="sd">    - Automatically handles coordinate system transformations</span>
<span class="sd">    - Generates multiple camera views for comprehensive visualization</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">    ---------</span>
<span class="sd">    &gt;&gt;&gt; # Basic usage with building simulation results</span>
<span class="sd">    &gt;&gt;&gt; building_mesh = trimesh.load(&#39;building_with_cfd_results.ply&#39;)</span>
<span class="sd">    &gt;&gt;&gt; building_mesh.metadata = {&#39;temperature&#39;: temperature_values}</span>
<span class="sd">    &gt;&gt;&gt; custom_meshes = {-3: building_mesh}  # -3 is building class ID</span>
<span class="sd">    &gt;&gt;&gt; </span>
<span class="sd">    &gt;&gt;&gt; visualize_voxcity_with_sim_meshes(</span>
<span class="sd">    ...     voxel_array, meshsize=2.0,</span>
<span class="sd">    ...     custom_meshes=custom_meshes,</span>
<span class="sd">    ...     value_name=&#39;temperature&#39;,</span>
<span class="sd">    ...     colormap=&#39;plasma&#39;,</span>
<span class="sd">    ...     colorbar_title=&#39;Temperature (C)&#39;,</span>
<span class="sd">    ...     vmin=15, vmax=35</span>
<span class="sd">    ... )</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # With ground-level wind simulation overlay</span>
<span class="sd">    &gt;&gt;&gt; wind_mesh = create_wind_simulation_mesh(wind_data)</span>
<span class="sd">    &gt;&gt;&gt; visualize_voxcity_with_sim_meshes(</span>
<span class="sd">    ...     voxel_array, 2.0,</span>
<span class="sd">    ...     custom_meshes={-3: wind_mesh},</span>
<span class="sd">    ...     value_name=&#39;wind_speed&#39;,</span>
<span class="sd">    ...     sim_grid=ground_wind_grid,</span>
<span class="sd">    ...     dem_grid=elevation_grid,</span>
<span class="sd">    ...     colormap=&#39;viridis&#39;,</span>
<span class="sd">    ...     projection_type=&#39;orthographic&#39;,</span>
<span class="sd">    ...     save_obj=True</span>
<span class="sd">    ... )</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # Multiple simulation types with custom styling</span>
<span class="sd">    &gt;&gt;&gt; meshes = {</span>
<span class="sd">    ...     -3: building_thermal_mesh,  # Buildings with thermal data</span>
<span class="sd">    ...     -2: vegetation_co2_mesh     # Vegetation with CO2 absorption</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; visualize_voxcity_with_sim_meshes(</span>
<span class="sd">    ...     voxel_array, 2.0,</span>
<span class="sd">    ...     custom_meshes=meshes,</span>
<span class="sd">    ...     value_name=&#39;co2_flux&#39;,</span>
<span class="sd">    ...     colormap=&#39;RdYlBu_r&#39;,</span>
<span class="sd">    ...     nan_color=&#39;lightgray&#39;,</span>
<span class="sd">    ...     distance_factor=1.5,</span>
<span class="sd">    ...     output_file_name=&#39;co2_analysis&#39;</span>
<span class="sd">    ... )</span>
<span class="sd">    </span>
<span class="sd">    See Also:</span>
<span class="sd">    ---------</span>
<span class="sd">    - visualize_building_sim_results(): Specialized function for building simulations</span>
<span class="sd">    - visualize_voxcity_multi_view(): Basic voxel visualization without custom meshes</span>
<span class="sd">    - create_multi_view_scene(): Lower-level rendering function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;Xvfb :99 -screen 0 1024x768x24 &gt; /dev/null 2&gt;&amp;1 &amp;&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DISPLAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;:99&#39;</span>

    <span class="c1"># Configure PyVista settings</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">set_plot_theme</span><span class="p">(</span><span class="s1">&#39;document&#39;</span><span class="p">)</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
    <span class="n">window_width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;window_width&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
    <span class="n">window_height</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;window_height&quot;</span><span class="p">,</span> <span class="mi">768</span><span class="p">)</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">window_width</span><span class="p">,</span> <span class="n">window_height</span><span class="p">]</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">jupyter_backend</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>
    
    <span class="c1"># Parse kwargs</span>
    <span class="n">voxel_color_map</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;voxel_color_map&quot;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="n">vox_dict</span> <span class="o">=</span> <span class="n">get_voxel_color_map</span><span class="p">(</span><span class="n">voxel_color_map</span><span class="p">)</span>
    <span class="n">output_directory</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output_directory&quot;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
    <span class="n">base_filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output_file_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">sim_grid</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sim_grid&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">dem_grid_ori</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dem_grid&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dem_grid_ori</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dem_grid</span> <span class="o">=</span> <span class="n">dem_grid_ori</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dem_grid_ori</span><span class="p">)</span>
    <span class="n">z_offset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;view_point_height&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
    <span class="n">cmap_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;colormap&quot;</span><span class="p">,</span> <span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">projection_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projection_type&quot;</span><span class="p">,</span> <span class="s2">&quot;perspective&quot;</span><span class="p">)</span>
    <span class="n">distance_factor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;distance_factor&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;colorbar_title&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">value_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">nan_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nan_color&quot;</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">show_views</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;show_views&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">save_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;save_obj&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">value_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Set value_name&quot;</span><span class="p">)</span>

    <span class="c1"># Create meshes from voxel data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating voxel meshes...&quot;</span><span class="p">)</span>
    <span class="n">meshes</span> <span class="o">=</span> <span class="n">create_city_meshes</span><span class="p">(</span><span class="n">voxel_array</span><span class="p">,</span> <span class="n">vox_dict</span><span class="p">,</span> <span class="n">meshsize</span><span class="o">=</span><span class="n">meshsize</span><span class="p">)</span>
    
    <span class="c1"># Replace specific voxel class meshes with custom simulation meshes</span>
    <span class="k">if</span> <span class="n">custom_meshes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">class_id</span><span class="p">,</span> <span class="n">custom_mesh</span> <span class="ow">in</span> <span class="n">custom_meshes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Apply coloring to custom meshes if they have metadata values</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">custom_mesh</span><span class="p">,</span> <span class="s1">&#39;metadata&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value_name</span> <span class="ow">in</span> <span class="n">custom_mesh</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
                <span class="c1"># Create a colored copy of the mesh for visualization</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.cm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cm</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mcolors</span>
                
                <span class="c1"># Get values from metadata</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">custom_mesh</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">value_name</span><span class="p">]</span>
                
                <span class="c1"># Set vmin/vmax if not provided</span>
                <span class="n">local_vmin</span> <span class="o">=</span> <span class="n">vmin</span> <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)])</span>
                <span class="n">local_vmax</span> <span class="o">=</span> <span class="n">vmax</span> <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)])</span>

                <span class="c1"># Create colors</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap_name</span><span class="p">)</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">local_vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">local_vmax</span><span class="p">)</span>
                
                <span class="c1"># Handle NaN values with custom color</span>
                <span class="n">face_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
                
                <span class="c1"># Convert string color to RGBA if needed</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nan_color</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mcolors</span>
                    <span class="n">nan_rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mcolors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">nan_color</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Assume it&#39;s already a tuple/list of RGBA values</span>
                    <span class="n">nan_rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nan_color</span><span class="p">)</span>
                
                <span class="c1"># Apply colors: NaN values get nan_color, others get colormap colors</span>
                <span class="n">nan_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="n">face_colors</span><span class="p">[</span><span class="o">~</span><span class="n">nan_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="o">~</span><span class="n">nan_mask</span><span class="p">]))</span>
                <span class="n">face_colors</span><span class="p">[</span><span class="n">nan_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">nan_rgba</span>
                
                <span class="c1"># Create a copy with colors</span>
                <span class="n">vis_mesh</span> <span class="o">=</span> <span class="n">custom_mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">vis_mesh</span><span class="o">.</span><span class="n">visual</span><span class="o">.</span><span class="n">face_colors</span> <span class="o">=</span> <span class="n">face_colors</span>

                <span class="c1"># Prepare the colormap and create colorbar</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">local_vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">local_vmax</span><span class="p">)</span>
                <span class="n">scalar_map</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_name</span><span class="p">)</span>
                
                <span class="c1"># Create a figure and axis for the colorbar but don&#39;t display</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scalar_map</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">colorbar_title</span><span class="p">:</span>
                    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colorbar_title</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  
                
                <span class="k">if</span> <span class="n">class_id</span> <span class="ow">in</span> <span class="n">meshes</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Replacing voxel class </span><span class="si">{</span><span class="n">class_id</span><span class="si">}</span><span class="s2"> with colored custom simulation mesh&quot;</span><span class="p">)</span>
                    <span class="n">meshes</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">vis_mesh</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding colored custom simulation mesh for class </span><span class="si">{</span><span class="n">class_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">meshes</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">vis_mesh</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># No metadata values, use the mesh as is</span>
                <span class="k">if</span> <span class="n">class_id</span> <span class="ow">in</span> <span class="n">meshes</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Replacing voxel class </span><span class="si">{</span><span class="n">class_id</span><span class="si">}</span><span class="s2"> with custom simulation mesh&quot;</span><span class="p">)</span>
                    <span class="n">meshes</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">custom_mesh</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding custom simulation mesh for class </span><span class="si">{</span><span class="n">class_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">meshes</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">custom_mesh</span>

    <span class="c1"># Create sim_grid surface mesh if provided</span>
    <span class="k">if</span> <span class="n">sim_grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dem_grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating sim_grid surface mesh...&quot;</span><span class="p">)</span>
        
        <span class="c1"># If vmin/vmax not provided, use actual min/max of the valid sim data</span>
        <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">sim_grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">sim_grid</span><span class="p">)</span>
            
        <span class="n">sim_mesh</span> <span class="o">=</span> <span class="n">create_sim_surface_mesh</span><span class="p">(</span>
            <span class="n">sim_grid</span><span class="p">,</span> <span class="n">dem_grid</span><span class="p">,</span>
            <span class="n">meshsize</span><span class="o">=</span><span class="n">meshsize</span><span class="p">,</span>
            <span class="n">z_offset</span><span class="o">=</span><span class="n">z_offset</span><span class="p">,</span>
            <span class="n">cmap_name</span><span class="o">=</span><span class="n">cmap_name</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="n">nan_color</span><span class="o">=</span><span class="n">nan_color</span>  <span class="c1"># Pass nan_color to the mesh creation</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">sim_mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">meshes</span><span class="p">[</span><span class="s2">&quot;sim_surface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_mesh</span>
            
        <span class="c1"># # Prepare the colormap and create colorbar</span>
        <span class="c1"># norm = mcolors.Normalize(vmin=vmin, vmax=vmax)</span>
        <span class="c1"># scalar_map = cm.ScalarMappable(norm=norm, cmap=cmap_name)</span>
        
        <span class="c1"># # Create a figure and axis for the colorbar but don&#39;t display</span>
        <span class="c1"># fig, ax = plt.subplots(figsize=(6, 1))</span>
        <span class="c1"># cbar = plt.colorbar(scalar_map, cax=ax, orientation=&#39;horizontal&#39;)</span>
        <span class="c1"># if colorbar_title:</span>
        <span class="c1">#     cbar.set_label(colorbar_title)</span>
        <span class="c1"># plt.tight_layout()</span>
        <span class="c1"># plt.show()</span>

    <span class="c1"># Export if filename provided</span>
    <span class="k">if</span> <span class="n">base_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exporting files to &#39;</span><span class="si">{</span><span class="n">base_filename</span><span class="si">}</span><span class="s2">.*&#39; ...&quot;</span><span class="p">)</span>
        <span class="c1"># Create output directory if it doesn&#39;t exist</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">export_meshes</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">output_directory</span><span class="p">,</span> <span class="n">base_filename</span><span class="p">)</span>

 
    <span class="c1"># Create and save multiple views</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating multiple views...&quot;</span><span class="p">)</span>        
    <span class="c1"># Create output directory if it doesn&#39;t exist</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_views</span><span class="p">:</span>
        <span class="n">image_files</span> <span class="o">=</span> <span class="n">create_multi_view_scene</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span> 
                                         <span class="n">projection_type</span><span class="o">=</span><span class="n">projection_type</span><span class="p">,</span> 
                                         <span class="n">distance_factor</span><span class="o">=</span><span class="n">distance_factor</span><span class="p">)</span>

        <span class="c1"># Display each view separately</span>
        <span class="k">for</span> <span class="n">view_name</span><span class="p">,</span> <span class="n">img_file</span> <span class="ow">in</span> <span class="n">image_files</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_file</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">view_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
    <span class="c1"># After creating the meshes and before visualization</span>
    <span class="k">if</span> <span class="n">save_obj</span><span class="p">:</span>
        <span class="n">output_directory</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output_directory&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
        <span class="n">output_file_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output_file_name&#39;</span><span class="p">,</span> <span class="s1">&#39;voxcity_mesh&#39;</span><span class="p">)</span>
        <span class="n">obj_path</span><span class="p">,</span> <span class="n">mtl_path</span> <span class="o">=</span> <span class="n">save_obj_from_colored_mesh</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">output_directory</span><span class="p">,</span> <span class="n">output_file_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved mesh files to:</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="n">obj_path</span><span class="si">}</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="n">mtl_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_building_sim_results</span><span class="p">(</span><span class="n">voxel_array</span><span class="p">,</span> <span class="n">meshsize</span><span class="p">,</span> <span class="n">building_sim_mesh</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize building simulation results by replacing building meshes in the original model.</span>
<span class="sd">    </span>
<span class="sd">    This is a specialized wrapper around visualize_voxcity_with_sim_meshes that specifically</span>
<span class="sd">    targets building simulation meshes (assuming building class ID is -3).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    voxel_array : np.ndarray</span>
<span class="sd">        3D array of voxel values.</span>
<span class="sd">    meshsize : float</span>
<span class="sd">        Size of each voxel in meters.</span>
<span class="sd">    building_sim_mesh : trimesh.Trimesh</span>
<span class="sd">        Simulation result mesh for buildings with values stored in metadata.</span>
<span class="sd">    **kwargs:</span>
<span class="sd">        Same parameters as visualize_voxcity_with_sim_meshes.</span>
<span class="sd">        Additional parameters:</span>
<span class="sd">        value_name : str</span>
<span class="sd">            Name of the field in metadata containing values to visualize (default: &#39;svf_values&#39;)</span>
<span class="sd">        nan_color : str or tuple</span>
<span class="sd">            Color for NaN values (default: &#39;gray&#39;)</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        List of (view_name, image_file_path) tuples for the generated views.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Building class ID is typically -3 in voxcity</span>
    <span class="n">building_class_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;building_class_id&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
    
    <span class="c1"># Create custom meshes dictionary with the building simulation mesh</span>
    <span class="n">custom_meshes</span> <span class="o">=</span> <span class="p">{</span><span class="n">building_class_id</span><span class="p">:</span> <span class="n">building_sim_mesh</span><span class="p">}</span>
    
    <span class="c1"># Add colorbar title if not provided</span>
    <span class="k">if</span> <span class="s2">&quot;colorbar_title&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="c1"># Try to guess a title based on the mesh name/type</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">building_sim_mesh</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">building_sim_mesh</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;colorbar_title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">building_sim_mesh</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use value_field name as fallback</span>
            <span class="n">value_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value_name&quot;</span><span class="p">,</span> <span class="s2">&quot;svf_values&quot;</span><span class="p">)</span>
            <span class="n">pretty_name</span> <span class="o">=</span> <span class="n">value_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;colorbar_title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pretty_name</span>
    
    <span class="c1"># Call the more general visualization function</span>
    <span class="n">visualize_voxcity_with_sim_meshes</span><span class="p">(</span>
        <span class="n">voxel_array</span><span class="p">,</span>
        <span class="n">meshsize</span><span class="p">,</span>
        <span class="n">custom_meshes</span><span class="o">=</span><span class="n">custom_meshes</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Kunihiko Fujiwara
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=8a448e45"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>